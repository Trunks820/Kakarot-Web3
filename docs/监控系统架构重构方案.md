# ç›‘æ§ç³»ç»Ÿæ¶æ„é‡æ„æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.2  
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-07  
> **æœ€åæ›´æ–°**: 2025-11-10  
> **çŠ¶æ€**: âœ… æ–¹æ¡ˆå®Œæˆ â†’ ğŸš§ å¼€å‘ä¸­ï¼ˆ85%ï¼‰â†’ âš¡ æ€§èƒ½ä¼˜åŒ–å®Œæˆ

---

## ğŸ“‹ ç›®å½•

1. [å½“å‰é—®é¢˜åˆ†æ](#å½“å‰é—®é¢˜åˆ†æ)
2. [æ¶æ„è®¾è®¡åŸåˆ™](#æ¶æ„è®¾è®¡åŸåˆ™)
3. [æ–°æ¶æ„è®¾è®¡](#æ–°æ¶æ„è®¾è®¡)
4. [è¡¨ç»“æ„è¯¦è®¾](#è¡¨ç»“æ„è¯¦è®¾)
5. [ä¸‰ç±»ç›‘æ§å®ç°](#ä¸‰ç±»ç›‘æ§å®ç°)
6. [æ‰¹æ¬¡åˆ†é…ç®—æ³•](#æ‰¹æ¬¡åˆ†é…ç®—æ³•)
7. [é…ç½®å˜æ›´æ„ŸçŸ¥](#é…ç½®å˜æ›´æ„ŸçŸ¥)
8. [é›¶åœæœºè¿ç§»æ–¹æ¡ˆ](#é›¶åœæœºè¿ç§»æ–¹æ¡ˆ)
9. [æ€§èƒ½æµ‹è¯•è®¡åˆ’](#æ€§èƒ½æµ‹è¯•è®¡åˆ’)
10. [é£é™©è¯„ä¼°ä¸å›æ»š](#é£é™©è¯„ä¼°ä¸å›æ»š)
11. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)
12. [å¼€å‘è¿›åº¦æ€»ç»“](#å¼€å‘è¿›åº¦æ€»ç»“)
13. [æ€§èƒ½ä¼˜åŒ–è®°å½•](#æ€§èƒ½ä¼˜åŒ–è®°å½•)
14. [å¾…è®¨è®ºé—®é¢˜](#å¾…è®¨è®ºé—®é¢˜)

---

## ğŸ” å½“å‰é—®é¢˜åˆ†æ

### ç°æœ‰è¡¨ç»“æ„

```
quick_monitor_template (é…ç½®è¡¨)
â”œâ”€â”€ id
â”œâ”€â”€ source_type (smart/batch)
â”œâ”€â”€ chain_type (sol/bsc)
â”œâ”€â”€ min_market_cap (ä»…smartä½¿ç”¨)
â”œâ”€â”€ time_interval
â”œâ”€â”€ top_holders_threshold
â”œâ”€â”€ events_config
â”œâ”€â”€ trigger_logic
â”œâ”€â”€ notify_methods
â””â”€â”€ status

sol_ws_batch_pool (æ‰¹æ¬¡+Tokenæ··åˆè¡¨)
â”œâ”€â”€ id
â”œâ”€â”€ source_type (smart/batch)
â”œâ”€â”€ chain_type
â”œâ”€â”€ batch_id
â”œâ”€â”€ ca (Tokenåœ°å€)
â”œâ”€â”€ token_name
â”œâ”€â”€ token_symbol
â”œâ”€â”€ market_cap
â”œâ”€â”€ template_id â†’ quick_monitor_template.id
â””â”€â”€ is_active
```

### æ ¸å¿ƒé—®é¢˜

#### 1. **æ•°æ®å†—ä½™ä¸¥é‡**
```
æ‰¹æ¬¡1: 99ä¸ªToken â†’ 99æ¡è®°å½•éƒ½å­˜ template_id=10
æ‰¹æ¬¡2: 99ä¸ªToken â†’ 99æ¡è®°å½•éƒ½å­˜ template_id=10
...
æ•°æ®é‡ 2000 æ¡ï¼Œå®é™…ä¸Šå¯èƒ½åªæœ‰ 20-30 ä¸ªä¸åŒçš„é…ç½®
```

#### 2. **æ¦‚å¿µæ··æ·†**
- `sol_ws_batch_pool` æ—¢å­˜æ‰¹æ¬¡ä¿¡æ¯ï¼Œåˆå­˜Tokenæ˜ç»†
- æŸ¥è¯¢æ‰¹æ¬¡åˆ—è¡¨éœ€è¦ `GROUP BY`ï¼Œå®¹æ˜“å‡ºç°é‡å¤
- æ‰¹æ¬¡é…ç½®åˆ†æ•£åœ¨å¤šæ¡Tokenè®°å½•ä¸­

#### 3. **æŸ¥è¯¢å¤æ‚**
```sql
-- æŸ¥è¯¢æ‰¹æ¬¡åˆ—è¡¨éœ€è¦å¤æ‚çš„GROUP BYå’ŒJOIN
SELECT 
  p.batch_id,
  min(t.config_name) as configName,
  count(*) as tokenCount
FROM sol_ws_batch_pool p
LEFT JOIN quick_monitor_template t ON p.template_id = t.id
GROUP BY p.batch_id, p.source_type, p.chain_type;
```

#### 4. **æ‰©å±•æ€§å·®**
- æ–°å¢ç›‘æ§ç±»å‹ï¼ˆå¦‚åŒºå—ç›‘æ§ï¼‰éœ€è¦æ–°å»ºè¡¨
- é…ç½®æ— æ³•åœ¨ä¸åŒç›‘æ§ç±»å‹é—´å¤ç”¨
- æ‰¹æ¬¡ç®¡ç†å’ŒTokenç®¡ç†è€¦åˆ

---

## ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™

### æ ¸å¿ƒç†å¿µï¼šèŒè´£åˆ†ç¦»ï¼Œçµæ´»å¤ç”¨

#### 1. **ä¸‰å±‚åˆ†ç¦»æ¶æ„**

- **é…ç½®å±‚ï¼ˆConfigurationï¼‰**ï¼šåªæè¿°ç›‘æ§è§„åˆ™ï¼ˆä»·æ ¼æ¶¨è·Œã€æŒä»“å˜åŒ–ã€æˆäº¤é‡ç­‰ï¼‰ï¼Œä¸ç›‘æ§ç›®æ ‡æ— å…³ï¼Œå¯è¢«å¤šä¸ªä»»åŠ¡å¤ç”¨
- **ä»»åŠ¡å±‚ï¼ˆTaskï¼‰**ï¼šå®šä¹‰ä¸€æ¬¡å…·ä½“ç›‘æ§ä»»åŠ¡ï¼ˆç±»å‹/é“¾åˆ«/è°ƒåº¦ç­–ç•¥ï¼‰ï¼Œç»‘å®šä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®
- **ç›®æ ‡å±‚ï¼ˆTargetï¼‰**ï¼šå­˜æ”¾è¦ç›‘æ§çš„å¯¹è±¡ï¼ˆCA/Pairï¼‰ï¼Œä»…æ™ºèƒ½ç›‘æ§å’Œæ‰¹é‡ç›‘æ§éœ€è¦ï¼›åŒºå—ç›‘æ§é€šå¸¸ä¸éœ€è¦

#### 2. **æ‰§è¡Œæ‰¹æ¬¡ç®¡ç†**

- æŠŠç›‘æ§ç›®æ ‡æŒ‰æ‰¹æ¬¡ï¼ˆâ‰¤99ä¸ª/æ‰¹ï¼‰åˆ†å‘ç»™ WebSocket æ¶ˆè´¹è€…
- ä¾¿äºæ°´å¹³æ‰©å±•ã€è´Ÿè½½å‡è¡¡å’Œå¯è§‚æµ‹æ€§ç›‘æ§

#### 3. **ç»Ÿä¸€å‘Šè­¦æ—¥å¿—**

- æ‰€æœ‰ç±»å‹çš„å‘Šè­¦è®°å½•åˆ°åŒä¸€å¼ è¡¨
- ä¾¿äºç»Ÿè®¡åˆ†æã€é—®é¢˜è¿½æº¯å’Œå»é‡å¤„ç†

#### 4. **é…ç½®ç‰ˆæœ¬åŒ–**

- é…ç½®æ”¯æŒç‰ˆæœ¬æ§åˆ¶ï¼Œå˜æ›´å¯è¿½æº¯
- ä»»åŠ¡å¯ä»¥ç»‘å®šç‰¹å®šç‰ˆæœ¬çš„é…ç½®ï¼Œæˆ–è‡ªåŠ¨ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬

---

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. é…ç½®å±‚ (Configuration)                                       â”‚
â”‚     monitor_config + monitor_task_config                        â”‚
â”‚     - å­˜å‚¨ç›‘æ§è§„åˆ™é…ç½®ï¼ˆä»·æ ¼/æŒä»“/æˆäº¤é‡ç­‰ï¼‰                      â”‚
â”‚     - æ”¯æŒç‰ˆæœ¬æ§åˆ¶ï¼Œå¯è¢«å¤šä¸ªä»»åŠ¡å¤ç”¨                             â”‚
â”‚     - ä»»åŠ¡ä¸é…ç½®æ˜¯å¤šå¯¹å¤šå…³ç³»ï¼ˆM:Nï¼‰                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ å¼•ç”¨ï¼ˆå¤šå¯¹å¤šï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ä»»åŠ¡å±‚ (Task)                                                â”‚
â”‚     monitor_task                                                â”‚
â”‚     - å®šä¹‰ç›‘æ§ä»»åŠ¡ï¼ˆç±»å‹/é“¾åˆ«/è°ƒåº¦ç­–ç•¥ï¼‰                          â”‚
â”‚     - åŒºå—ç›‘æ§(block)ï¼šå…¨ç½‘ç›‘å¬ï¼Œæ— éœ€ç›®æ ‡                        â”‚
â”‚     - æ™ºèƒ½ç›‘æ§(smart)ï¼šç›®æ ‡è‡ªåŠ¨ç”Ÿæˆï¼ˆå¸‚å€¼ç­›é€‰ï¼‰                   â”‚
â”‚     - æ‰¹é‡ç›‘æ§(batch)ï¼šç›®æ ‡æ‰‹åŠ¨è¾“å…¥ï¼ˆç”¨æˆ·ä¸Šä¼ CAï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ å…³è”ï¼ˆå¯é€‰ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ç›®æ ‡å±‚ (Target) - ä»… smart/batch éœ€è¦                        â”‚
â”‚     monitor_task_target                                         â”‚
â”‚     - ç»Ÿä¸€å­˜å‚¨ç›‘æ§ç›®æ ‡ï¼ˆCA/Pair/Poolï¼‰                           â”‚
â”‚     - æ”¯æŒåŠ¨æ€å¢åˆ ï¼Œè‡ªåŠ¨é‡æ–°åˆ†é…æ‰¹æ¬¡                             â”‚
â”‚     - ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œä¿è¯æ‰¹æ¬¡ç¨³å®š                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ åˆ†é…æ‰¹æ¬¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ‰§è¡Œå±‚ (Execution)                                           â”‚
â”‚     monitor_batch + monitor_batch_item                          â”‚
â”‚     - æ‰¹æ¬¡å¤´ï¼šå…ƒä¿¡æ¯ã€å¿ƒè·³ã€ç»Ÿè®¡                                 â”‚
â”‚     - æ‰¹æ¬¡é¡¹ï¼šâ‰¤99ä¸ªCA/æ‰¹ï¼Œåˆ†å‘ç»™WSæ¶ˆè´¹è€…                         â”‚
â”‚     - Pythonç›‘æ§è¿›ç¨‹è¯»å–å¹¶è®¢é˜…                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ äº§ç”Ÿå‘Šè­¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å‘Šè­¦å±‚ (Alert)                                               â”‚
â”‚     monitor_alert_log                                           â”‚
â”‚     - ç»Ÿä¸€å‘Šè­¦æ—¥å¿—ï¼ˆalert_keyå»é‡ï¼‰                              â”‚
â”‚     - è®°å½•å»¶è¿ŸæŒ‡æ ‡ï¼ˆæ£€æµ‹å»¶è¿Ÿã€é€šçŸ¥å»¶è¿Ÿï¼‰                          â”‚
â”‚     - æ”¯æŒå¤šé€šçŸ¥æ¸ é“ï¼ˆTelegram/WeChat/é‚®ä»¶ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç‰¹æ€§

#### âœ… **é…ç½®ä¸ä»»åŠ¡å¤šå¯¹å¤š**
- ä¸€ä¸ªä»»åŠ¡å¯ä»¥ç»„åˆå¤šä¸ªé…ç½®ï¼ˆå¦‚ï¼šä»·æ ¼ç›‘æ§ + æŒä»“ç›‘æ§ + æˆäº¤é‡ç›‘æ§ï¼‰
- ä¸€ä¸ªé…ç½®å¯ä»¥è¢«å¤šä¸ªä»»åŠ¡å¤ç”¨ï¼Œä¿®æ”¹ä¸€æ¬¡é…ç½®ï¼Œæ‰€æœ‰ä»»åŠ¡è‡ªåŠ¨ç”Ÿæ•ˆ

#### âœ… **ç›®æ ‡å±‚ç»Ÿä¸€æŠ½è±¡**
- æ™ºèƒ½ç›‘æ§ï¼šç›®æ ‡ä» `token_launch_history` è‡ªåŠ¨ç­›é€‰ï¼Œå®šæœŸåŒæ­¥
- æ‰¹é‡ç›‘æ§ï¼šç”¨æˆ·æ‰‹åŠ¨è¾“å…¥CAåˆ—è¡¨ï¼Œä¸€æ¬¡æ€§å¯¼å…¥
- åŒºå—ç›‘æ§ï¼šæ— éœ€ç›®æ ‡å±‚ï¼Œç›´æ¥å…¨ç½‘ç›‘å¬

#### âœ… **æ‰¹æ¬¡åˆ†é…ç®—æ³•**
- ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå¯¹ç›®æ ‡æ’åºï¼Œä¿è¯å¤šæ¬¡åˆ†é…æ—¶å¤§éƒ¨åˆ†æ‰¹æ¬¡ä¸å˜
- ä»…å¯¹æ–°å¢/åˆ é™¤çš„ç›®æ ‡è°ƒæ•´æ‰¹æ¬¡ï¼Œå‡å°‘WSè¿æ¥çš„é‡å»ºå¼€é”€

---

## ğŸ“Š è¡¨ç»“æ„å¯¹æ¯”

### æ–°è¡¨ç»“æ„

#### 1. **monitor_config** (ç›‘æ§é…ç½®è¡¨) - å¯å¤ç”¨çš„è§„åˆ™å®šä¹‰

```sql
CREATE TABLE monitor_config (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é…ç½®ID',
  config_name VARCHAR(100) NOT NULL COMMENT 'é…ç½®åç§°',
  config_type VARCHAR(20) DEFAULT 'composite' COMMENT 'é…ç½®ç±»å‹ï¼šprice/holder/volume/composite',
  chain_type VARCHAR(10) NOT NULL COMMENT 'é“¾ç±»å‹ï¼šsol/bsc/eth',
  
  -- ğŸ†• é‡è¦å­—æ®µï¼ˆä¸ç°æœ‰ global_monitor_config å¯¹é½ï¼‰
  source VARCHAR(20) COMMENT 'æ•°æ®æºç­›é€‰ï¼šall/pump/fourmeme',
  market_type VARCHAR(20) DEFAULT 'external' COMMENT 'å¸‚åœºç±»å‹ï¼šinternal-å†…ç›˜/external-å¤–ç›˜',
  min_transaction_usd DECIMAL(20,2) COMMENT 'å•ç¬”æœ€å°äº¤æ˜“é‡‘é¢(USD)',
  cumulative_min_amount_usd DECIMAL(20,2) COMMENT 'ç´¯è®¡æœ€å°é‡‘é¢(USD)',
  
  -- ç›‘æ§é…ç½®ï¼ˆJSONæ ¼å¼ï¼Œçµæ´»æ‰©å±•ï¼‰
  time_interval VARCHAR(10) DEFAULT '5m' COMMENT 'æ—¶é—´å‘¨æœŸï¼š1m/5m/1h/24h',
  top_holders_threshold DECIMAL(5,2) COMMENT 'å‰åæŒä»“é˜ˆå€¼%',
  events_config JSON COMMENT 'äº‹ä»¶é…ç½®: {priceChange:{enabled,risePercent,fallPercent}, holders:{...}, volume:{...}}',
  trigger_logic VARCHAR(10) DEFAULT 'any' COMMENT 'è§¦å‘é€»è¾‘ï¼šany-ä»»ä¸€æ»¡è¶³/all-å…¨éƒ¨æ»¡è¶³',
  notify_methods VARCHAR(100) DEFAULT 'telegram' COMMENT 'é€šçŸ¥æ–¹å¼ï¼štelegram,wechat,email',
  
  -- ç‰ˆæœ¬æ§åˆ¶
  version INT DEFAULT 1 COMMENT 'é…ç½®ç‰ˆæœ¬å·',
  
  -- å…ƒæ•°æ®
  description TEXT COMMENT 'é…ç½®æè¿°',
  status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-å¯ç”¨/0-åœç”¨',
  create_by VARCHAR(64) COMMENT 'åˆ›å»ºè€…',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_by VARCHAR(64) COMMENT 'æ›´æ–°è€…',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  del_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—ï¼š0-æœªåˆ é™¤/1-å·²åˆ é™¤',
  
  KEY idx_chain_type (chain_type),
  KEY idx_status (status),
  KEY idx_update_time (update_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›‘æ§é…ç½®è¡¨-å¯å¤ç”¨çš„è§„åˆ™å®šä¹‰';

-- ç¤ºä¾‹æ•°æ®
INSERT INTO monitor_config (config_name, config_type, chain_type, events_config, trigger_logic) VALUES
('BSC ä»·æ ¼æš´æ¶¨é¢„è­¦', 'price', 'bsc', '{"priceChange":{"enabled":true,"risePercent":30}}', 'any'),
('SOL æŒä»“é›†ä¸­åº¦é¢„è­¦', 'holder', 'sol', '{"holders":{"enabled":true,"increasePercent":20}}', 'any'),
('ç»¼åˆç›‘æ§-é«˜é£é™©', 'composite', 'bsc', '{"priceChange":{"enabled":true,"risePercent":50},"volume":{"enabled":true,"threshold":10000}}', 'all');
```

#### 2. **monitor_task** (ç›‘æ§ä»»åŠ¡è¡¨) - å®šä¹‰å…·ä½“ç›‘æ§

```sql
CREATE TABLE monitor_task (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä»»åŠ¡ID',
  task_name VARCHAR(100) NOT NULL COMMENT 'ä»»åŠ¡åç§°',
  task_type VARCHAR(20) NOT NULL COMMENT 'ä»»åŠ¡ç±»å‹ï¼šsmart-æ™ºèƒ½/batch-æ‰¹é‡/block-åŒºå—',
  chain_type VARCHAR(10) NOT NULL COMMENT 'é“¾ç±»å‹ï¼šsol/bsc/eth',
  
  -- æ™ºèƒ½ç›‘æ§ä¸“ç”¨å­—æ®µ
  min_market_cap DECIMAL(20,2) COMMENT 'æœ€å°å¸‚å€¼(ä»…smart)',
  max_market_cap DECIMAL(20,2) COMMENT 'æœ€å¤§å¸‚å€¼(ä»…smart)',
  has_twitter TINYINT COMMENT 'æ˜¯å¦æœ‰Twitter(ä»…smart)',
  auto_sync_targets TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦è‡ªåŠ¨åŒæ­¥ç›®æ ‡(ä»…smart)',
  sync_interval_minutes INT DEFAULT 30 COMMENT 'åŒæ­¥é—´éš”åˆ†é’Ÿæ•°(ä»…smart)',
  
  -- æ‰¹é‡ç›‘æ§ä¸“ç”¨å­—æ®µ
  target_count INT DEFAULT 0 COMMENT 'ç›®æ ‡æ•°é‡(ä»…batch)',
  
  -- è°ƒåº¦é…ç½®
  schedule_cron VARCHAR(50) COMMENT 'å®šæ—¶è§„åˆ™(å¯é€‰)',
  
  -- æ‰§è¡ŒçŠ¶æ€
  status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-å¯ç”¨/0-åœç”¨/2-æš‚åœ',
  last_run_time DATETIME COMMENT 'æœ€åæ‰§è¡Œæ—¶é—´',
  next_run_time DATETIME COMMENT 'ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´',
  
  -- å…ƒæ•°æ®
  description TEXT COMMENT 'ä»»åŠ¡æè¿°',
  create_by VARCHAR(64) COMMENT 'åˆ›å»ºè€…',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_by VARCHAR(64) COMMENT 'æ›´æ–°è€…',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  KEY idx_task_type (task_type),
  KEY idx_chain_type (chain_type),
  KEY idx_status (status),
  KEY idx_update_time (update_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›‘æ§ä»»åŠ¡è¡¨';
```

#### 3. **monitor_task_config** (ä»»åŠ¡é…ç½®å…³è”è¡¨) - å¤šå¯¹å¤šæ˜ å°„

```sql
CREATE TABLE monitor_task_config (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å…³è”ID',
  task_id BIGINT NOT NULL COMMENT 'ä»»åŠ¡ID',
  config_id BIGINT NOT NULL COMMENT 'é…ç½®ID',
  config_order INT DEFAULT 0 COMMENT 'é…ç½®ä¼˜å…ˆçº§(æ•°å­—è¶Šå°è¶Šä¼˜å…ˆ)',
  override_settings JSON COMMENT 'è¦†ç›–é…ç½®(å¯é€‰)',
  is_active TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨æ­¤é…ç½®',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  
  UNIQUE KEY uk_task_config (task_id, config_id),
  KEY idx_task_id (task_id),
  KEY idx_config_id (config_id),
  
  FOREIGN KEY (task_id) REFERENCES monitor_task(id) ON DELETE CASCADE,
  FOREIGN KEY (config_id) REFERENCES monitor_config(id) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä»»åŠ¡é…ç½®å…³è”è¡¨';
```

#### 4. **monitor_task_target** (ç›‘æ§ç›®æ ‡è¡¨) - ç»Ÿä¸€å­˜å‚¨ç›®æ ‡

```sql
CREATE TABLE monitor_task_target (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç›®æ ‡ID',
  task_id BIGINT NOT NULL COMMENT 'ä»»åŠ¡ID',
  target_type VARCHAR(20) NOT NULL COMMENT 'ç›®æ ‡ç±»å‹ï¼šca/pair/pool',
  target_value VARCHAR(255) NOT NULL COMMENT 'ç›®æ ‡å€¼(åˆçº¦åœ°å€/äº¤æ˜“å¯¹ç­‰)',
  
  -- å…ƒæ•°æ®(å†—ä½™,ä¾¿äºæŸ¥è¯¢)
  token_name VARCHAR(100) COMMENT 'Tokenåç§°',
  token_symbol VARCHAR(50) COMMENT 'Tokenç¬¦å·',
  market_cap DECIMAL(20,2) COMMENT 'å¸‚å€¼',
  pair_address VARCHAR(255) COMMENT 'äº¤æ˜“å¯¹åœ°å€',
  source VARCHAR(20) COMMENT 'æ¥æºï¼špump/fourmeme/manual',
  twitter_url VARCHAR(255) COMMENT 'Twitteré“¾æ¥',
  
  -- æ‰¹æ¬¡åˆ†é…
  batch_id INT COMMENT 'åˆ†é…çš„æ‰¹æ¬¡ID',
  batch_order INT COMMENT 'æ‰¹æ¬¡å†…åºå·(0-98)',
  
  -- çŠ¶æ€ç®¡ç†
  status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-æ´»è·ƒ/0-åœç”¨/2-å·²åˆ é™¤',
  priority INT DEFAULT 0 COMMENT 'ä¼˜å…ˆçº§',
  
  -- å®¡è®¡
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  UNIQUE KEY uk_task_target (task_id, target_type, target_value),
  KEY idx_batch (task_id, batch_id),
  KEY idx_status (status),
  KEY idx_source (source),
  
  FOREIGN KEY (task_id) REFERENCES monitor_task(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›‘æ§ç›®æ ‡è¡¨';
```

#### 5. **monitor_batch** (æ‰¹æ¬¡å¤´è¡¨) - æ‰¹æ¬¡å…ƒä¿¡æ¯

```sql
CREATE TABLE monitor_batch (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ‰¹æ¬¡ID',
  task_id BIGINT NOT NULL COMMENT 'ä»»åŠ¡ID',
  batch_no INT NOT NULL COMMENT 'æ‰¹æ¬¡ç¼–å·(ä»1å¼€å§‹)',
  item_count INT DEFAULT 0 COMMENT 'æœ¬æ‰¹æ¬¡é¡¹æ•°(â‰¤99)',
  
  -- æ‰§è¡ŒçŠ¶æ€
  status VARCHAR(20) DEFAULT 'pending' COMMENT 'çŠ¶æ€ï¼špending/running/paused/stopped',
  worker_id VARCHAR(50) COMMENT 'æ‰§è¡ŒèŠ‚ç‚¹ID',
  worker_pid INT COMMENT 'è¿›ç¨‹ID',
  last_heartbeat DATETIME COMMENT 'æœ€åå¿ƒè·³æ—¶é—´',
  
  -- ç»Ÿè®¡ä¿¡æ¯
  total_alerts INT DEFAULT 0 COMMENT 'ç´¯è®¡å‘Šè­¦æ•°',
  last_alert_time DATETIME COMMENT 'æœ€åå‘Šè­¦æ—¶é—´',
  error_count INT DEFAULT 0 COMMENT 'é”™è¯¯æ¬¡æ•°',
  last_error TEXT COMMENT 'æœ€åé”™è¯¯ä¿¡æ¯',
  
  -- å®¡è®¡
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  UNIQUE KEY uk_task_batch (task_id, batch_no),
  KEY idx_worker (worker_id),
  KEY idx_heartbeat (last_heartbeat),
  KEY idx_status (status),
  
  FOREIGN KEY (task_id) REFERENCES monitor_task(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰¹æ¬¡å¤´è¡¨';
```

#### 6. **monitor_batch_item** (æ‰¹æ¬¡é¡¹è¡¨) - æ‰¹æ¬¡è¯¦æƒ…

```sql
CREATE TABLE monitor_batch_item (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®°å½•ID',
  batch_id BIGINT NOT NULL COMMENT 'æ‰¹æ¬¡ID',
  target_id BIGINT NOT NULL COMMENT 'ç›®æ ‡ID',
  item_order INT COMMENT 'æ‰¹æ¬¡å†…åºå·(0-98)',
  
  -- å†—ä½™å­—æ®µ(é¿å…JOIN)
  ca VARCHAR(255) COMMENT 'Tokenåˆçº¦åœ°å€',
  token_name VARCHAR(100) COMMENT 'Tokenåç§°',
  
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  
  UNIQUE KEY uk_batch_target (batch_id, target_id),
  KEY idx_target (target_id),
  
  FOREIGN KEY (batch_id) REFERENCES monitor_batch(id) ON DELETE CASCADE,
  FOREIGN KEY (target_id) REFERENCES monitor_task_target(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰¹æ¬¡é¡¹è¡¨';
```

#### 7. **monitor_alert_log** (ç›‘æ§å‘Šè­¦æ—¥å¿—è¡¨) - ç»Ÿä¸€å‘Šè­¦

```sql
CREATE TABLE monitor_alert_log (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å‘Šè­¦ID',
  task_id BIGINT NOT NULL COMMENT 'å…³è”ä»»åŠ¡ID',
  config_id BIGINT COMMENT 'è§¦å‘çš„é…ç½®ID',
  
  -- å»é‡key(MD5: task_id+ca+alert_type+date)
  alert_key VARCHAR(32) COMMENT 'å‘Šè­¦å»é‡é”®',
  
  -- åŸºæœ¬ä¿¡æ¯
  task_type VARCHAR(20) NOT NULL COMMENT 'ä»»åŠ¡ç±»å‹ï¼šsmart/batch/block',
  chain_type VARCHAR(10) NOT NULL COMMENT 'é“¾ç±»å‹',
  
  -- Tokenä¿¡æ¯(å¯é€‰)
  ca VARCHAR(255) COMMENT 'Tokenåœ°å€',
  token_name VARCHAR(100) COMMENT 'Tokenåç§°',
  token_symbol VARCHAR(50) COMMENT 'Tokenç¬¦å·',
  market_cap DECIMAL(20,2) COMMENT 'å¸‚å€¼',
  
  -- å‘Šè­¦è¯¦æƒ…
  alert_type VARCHAR(50) NOT NULL COMMENT 'å‘Šè­¦ç±»å‹ï¼šprice_change/holder_change/volume_change/block_event',
  alert_title VARCHAR(200) COMMENT 'å‘Šè­¦æ ‡é¢˜',
  alert_content JSON COMMENT 'å‘Šè­¦å†…å®¹(è¯¦ç»†æ•°æ®)',
  trigger_value DECIMAL(20,4) COMMENT 'è§¦å‘å€¼',
  
  -- é€šçŸ¥çŠ¶æ€
  notify_status VARCHAR(20) DEFAULT 'pending' COMMENT 'é€šçŸ¥çŠ¶æ€ï¼špending/sent/failed/skipped',
  notify_channels VARCHAR(100) COMMENT 'é€šçŸ¥æ¸ é“ï¼štelegram,wechat',
  notify_time DATETIME COMMENT 'é€šçŸ¥æ—¶é—´',
  notify_error TEXT COMMENT 'é€šçŸ¥é”™è¯¯ä¿¡æ¯',
  
  -- æ€§èƒ½æŒ‡æ ‡
  detect_latency_ms INT COMMENT 'æ£€æµ‹å»¶è¿Ÿ(æ¯«ç§’)',
  notify_latency_ms INT COMMENT 'é€šçŸ¥å»¶è¿Ÿ(æ¯«ç§’)',
  
  -- å…ƒæ•°æ®
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  
  UNIQUE KEY uk_alert_key (alert_key),
  KEY idx_task (task_id),
  KEY idx_ca (ca),
  KEY idx_alert_type (alert_type),
  KEY idx_create_time (create_time),
  KEY idx_notify_status (notify_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›‘æ§å‘Šè­¦æ—¥å¿—è¡¨';
```

### æ•°æ®é‡å¯¹æ¯”

| è¡¨å | æ—§æ¶æ„ | æ–°æ¶æ„ | è¯´æ˜ |
|------|--------|--------|------|
| é…ç½® | 2000æ¡(å†—ä½™) | ~30æ¡ | é…ç½®ç‹¬ç«‹å­˜å‚¨ |
| æ‰¹æ¬¡å…ƒä¿¡æ¯ | æ—  | ~30æ¡ | æ‰¹æ¬¡ä½œä¸ºç‹¬ç«‹å®ä½“ |
| Tokenæ˜ç»† | 2000æ¡ | 2000æ¡ | ä¸å˜ |
| å‘Šè­¦æ—¥å¿— | åˆ†æ•£å¤šè¡¨ | ç»Ÿä¸€å­˜å‚¨ | æŸ¥è¯¢æ›´æ–¹ä¾¿ |

---

## ğŸš€ ä¸‰ç±»ç›‘æ§å®ç°

### 1. åŒºå—ç›‘æ§ï¼ˆBlock Monitorï¼‰- æœ€ç®€å•

**ç‰¹ç‚¹**ï¼šå…¨ç½‘ç›‘å¬ï¼Œä¸éœ€è¦ç›®æ ‡å±‚

```python
# å®ç°ç¤ºä¾‹
def execute_block_monitor(task_id):
    # 1. åŠ è½½ä»»åŠ¡é…ç½®
    task = db.query_one("SELECT * FROM monitor_task WHERE id = %s", (task_id,))
    configs = load_task_configs(task_id)  # ä» monitor_task_config åŠ è½½
    
    # 2. è®¢é˜…å…¨å±€åŒºå—äº‹ä»¶
    ws_client.subscribe_blocks(
        chain=task['chain_type'],
        callback=lambda event: check_rules(event, configs)
    )
```

### 2. æ‰¹é‡ç›‘æ§ï¼ˆBatch Monitorï¼‰- ç”¨æˆ·æ‰‹åŠ¨

**ç‰¹ç‚¹**ï¼šç”¨æˆ·ä¸Šä¼ CAåˆ—è¡¨

```python
def create_batch_monitor(ca_list, config_ids):
    # 1. åˆ›å»ºä»»åŠ¡
    task_id = db.insert("INSERT INTO monitor_task (task_name, task_type, chain_type) VALUES (...)")
    
    # 2. å…³è”é…ç½®
    for config_id in config_ids:
        db.insert("INSERT INTO monitor_task_config (task_id, config_id) VALUES (%s, %s)", (task_id, config_id))
    
    # 3. æ‰¹é‡æ’å…¥ç›®æ ‡
    for ca in ca_list:
        db.insert("INSERT INTO monitor_task_target (task_id, target_type, target_value) VALUES (%s, 'ca', %s)", (task_id, ca))
    
    # 4. åˆ†é…æ‰¹æ¬¡
    allocate_batches(task_id)
```

### 3. æ™ºèƒ½ç›‘æ§ï¼ˆSmart Monitorï¼‰- è‡ªåŠ¨ç”Ÿæˆ

**ç‰¹ç‚¹**ï¼šä» token_launch_history è‡ªåŠ¨ç­›é€‰ï¼Œå¹‚ç­‰å¢é‡å¯¹è´¦

```python
def sync_smart_monitor_targets(task_id):
    # 1. è¯»å–ä»»åŠ¡æ¡ä»¶
    task = db.query_one("""
        SELECT t.*, c.source, c.min_transaction_usd
        FROM monitor_task t
        JOIN monitor_task_config tc ON t.id = tc.task_id
        JOIN monitor_config c ON tc.config_id = c.id
        WHERE t.id = %s AND t.task_type = 'smart'
    """, (task_id,))
    
    # 2. ç­›é€‰ç¬¦åˆæ¡ä»¶çš„Tokenï¼ˆæ’é™¤å·²æœ‰ï¼‰
    new_tokens = db.query("""
        SELECT ca, token_name, market_cap, source
        FROM token_launch_history
        WHERE chain_type = %s
          AND source = %s
          AND market_cap BETWEEN %s AND %s
          AND create_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
          AND ca NOT IN (
              SELECT target_value FROM monitor_task_target 
              WHERE task_id = %s AND status = 1
          )
        LIMIT 500
    """, (task['chain_type'], task['source'], task['min_market_cap'], task['max_market_cap'], task_id))
    
    # 3. å¹‚ç­‰æ’å…¥ï¼ˆON DUPLICATE KEY UPDATEï¼‰
    for token in new_tokens:
        db.execute("""
            INSERT INTO monitor_task_target 
                (task_id, target_type, target_value, token_name, market_cap, source, status)
            VALUES (%s, 'ca', %s, %s, %s, %s, 1)
            ON DUPLICATE KEY UPDATE status = 1, market_cap = VALUES(market_cap)
        """, (task_id, token['ca'], token['token_name'], token['market_cap'], token['source']))
    
    # 4. é‡æ–°åˆ†é…æ‰¹æ¬¡
    allocate_batches(task_id)
```

---

## ğŸ“¦ æ‰¹æ¬¡åˆ†é…ç®—æ³•

### ä¸€è‡´æ€§å“ˆå¸Œä¿è¯æ‰¹æ¬¡ç¨³å®š

```python
import hashlib

class BatchAllocator:
    BATCH_SIZE = 99
    
    def allocate_batches(self, task_id):
        """å¯¹ä»»åŠ¡çš„æ‰€æœ‰ç›®æ ‡è¿›è¡Œæ‰¹æ¬¡åˆ†é…"""
        # 1. è¯»å–æ‰€æœ‰æ´»è·ƒç›®æ ‡
        targets = db.query("""
            SELECT id, target_value, batch_id
            FROM monitor_task_target
            WHERE task_id = %s AND status = 1
            ORDER BY id
        """, (task_id,))
        
        if not targets:
            return
        
        # 2. ä¸€è‡´æ€§å“ˆå¸Œæ’åºï¼ˆä¿è¯å¤šæ¬¡åˆ†é…ç»“æœç›¸åŒï¼‰
        def hash_target(target_value):
            return int(hashlib.md5(target_value.encode()).hexdigest(), 16)
        
        targets_sorted = sorted(targets, key=lambda x: hash_target(x['target_value']))
        
        # 3. åˆ†é…æ‰¹æ¬¡ï¼ˆæ¯æ‰¹â‰¤99ä¸ªï¼‰
        total_batches = (len(targets_sorted) + self.BATCH_SIZE - 1) // self.BATCH_SIZE
        
        updates = []
        for idx, target in enumerate(targets_sorted):
            new_batch_id = (idx // self.BATCH_SIZE) + 1
            new_batch_order = idx % self.BATCH_SIZE
            
            # åªæ›´æ–°å˜åŒ–çš„ç›®æ ‡
            if target['batch_id'] != new_batch_id:
                updates.append((new_batch_id, new_batch_order, target['id']))
        
        # 4. æ‰¹é‡æ›´æ–°
        if updates:
            db.executemany("""
                UPDATE monitor_task_target
                SET batch_id = %s, batch_order = %s, update_time = NOW()
                WHERE id = %s
            """, updates)
            
            log.info(f"ä»»åŠ¡ {task_id}: {len(targets_sorted)} ä¸ªç›®æ ‡, {total_batches} ä¸ªæ‰¹æ¬¡, å˜æ›´ {len(updates)} é¡¹")
        
        # 5. æ›´æ–°æ‰¹æ¬¡å¤´ä¿¡æ¯
        self._sync_batch_headers(task_id, total_batches)
    
    def _sync_batch_headers(self, task_id, expected_batches):
        """åŒæ­¥æ‰¹æ¬¡å¤´è¡¨"""
        for batch_no in range(1, expected_batches + 1):
            db.execute("""
                INSERT INTO monitor_batch (task_id, batch_no, item_count, status)
                SELECT %s, %s, COUNT(*), 'pending'
                FROM monitor_task_target
                WHERE task_id = %s AND batch_id = %s AND status = 1
                ON DUPLICATE KEY UPDATE
                    item_count = VALUES(item_count),
                    update_time = NOW()
            """, (task_id, batch_no, task_id, batch_no))
```

---

## ğŸ”” é…ç½®å˜æ›´æ„ŸçŸ¥

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å®æ—¶æ€§ | å¤æ‚åº¦ | å¯é æ€§ | æ¨è |
|------|--------|--------|--------|------|
| A. è½®è¯¢å¢é‡ | 5-15s | ä½ | é«˜ | âœ… å…œåº•å¿…é¡» |
| B. Redis Pub/Sub | <1s | ä¸­ | ä¸­ | âœ… æ¨è |
| C. CDC/Binlog | <0.5s | é«˜ | é«˜ | å¤§è§„æ¨¡ |

### æ¨èå®ç°ï¼šA + B ç»„åˆ

#### Java åç«¯å‘å¸ƒå˜æ›´äº‹ä»¶

```java
@Service
public class MonitorConfigServiceImpl {
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Override
    @Transactional
    public int updateMonitorConfig(MonitorConfig config) {
        // 1. æ›´æ–°æ•°æ®åº“
        config.setUpdateTime(new Date());
        config.setVersion(config.getVersion() + 1);
        int result = configMapper.update(config);
        
        // 2. å‘å¸ƒRedisäº‹ä»¶
        if (result > 0) {
            ConfigChangeEvent event = new ConfigChangeEvent();
            event.setConfigId(config.getId());
            event.setChangeType("update");
            event.setVersion(config.getVersion());
            event.setTimestamp(System.currentTimeMillis());
            
            redisTemplate.convertAndSend("monitor:config:changed", JSON.toJSONString(event));
            log.info("ğŸ“¢ é…ç½®å˜æ›´äº‹ä»¶: configId={}, version={}", config.getId(), config.getVersion());
        }
        
        return result;
    }
}
```

#### Python ç›‘æ§è¿›ç¨‹è®¢é˜…

```python
class ConfigWatcher:
    def __init__(self):
        self.redis_client = redis.Redis()
        self.config_cache = {}
        self.last_poll_time = datetime.now()
    
    def start(self):
        # å¯åŠ¨Redisè®¢é˜…çº¿ç¨‹
        threading.Thread(target=self._subscribe_redis, daemon=True).start()
        
        # å¯åŠ¨è½®è¯¢å…œåº•çº¿ç¨‹
        threading.Thread(target=self._poll_changes, daemon=True).start()
    
    def _subscribe_redis(self):
        """Redis Pub/Subè®¢é˜…"""
        pubsub = self.redis_client.pubsub()
        pubsub.subscribe('monitor:config:changed')
        
        for message in pubsub.listen():
            if message['type'] == 'message':
                event = json.loads(message['data'])
                self._reload_config(event['configId'], event['version'])
    
    def _poll_changes(self):
        """è½®è¯¢å¢é‡ï¼ˆ5ç§’é—´éš”ï¼Œå…œåº•ï¼‰"""
        while True:
            time.sleep(5)
            try:
                changed_configs = db.query("""
                    SELECT id, version, update_time
                    FROM monitor_config
                    WHERE update_time > %s
                    ORDER BY update_time DESC
                """, (self.last_poll_time,))
                
                for config in changed_configs:
                    cached_version = self.config_cache.get(config['id'], {}).get('version', 0)
                    if config['version'] > cached_version:
                        self._reload_config(config['id'], config['version'])
                
                self.last_poll_time = datetime.now()
            except Exception as e:
                log.error(f"è½®è¯¢å¤±è´¥: {e}")
    
    def _reload_config(self, config_id, version):
        """é‡è½½é…ç½®ï¼ˆ2ç§’å»æŠ–ï¼Œå¹‚ç­‰ï¼‰"""
        last_reload = self.config_cache.get(config_id, {}).get('last_reload_time')
        if last_reload and (datetime.now() - last_reload).seconds < 2:
            return
        
        config = db.query_one("SELECT * FROM monitor_config WHERE id = %s", (config_id,))
        if config:
            self.config_cache[config_id] = config
            self.config_cache[config_id]['last_reload_time'] = datetime.now()
            
            # é‡æ–°åŠ è½½ä½¿ç”¨è¯¥é…ç½®çš„æ‰€æœ‰ä»»åŠ¡
            self._reload_tasks_by_config(config_id)
            log.info(f"âœ… é…ç½®å·²é‡è½½: configId={config_id}, version={version}")
```

---

## ğŸ”„ é›¶åœæœºè¿ç§»æ–¹æ¡ˆ

### è¿ç§»ç­–ç•¥ï¼šåŒå†™ â†’ ç°åº¦åˆ‡æ¢ â†’ å®Œå…¨è¿ç§»

### é˜¶æ®µ1ï¼šå‡†å¤‡é˜¶æ®µï¼ˆ1å¤©ï¼‰

#### 1.1 åˆ›å»ºæ–°è¡¨
```sql
-- æ‰§è¡Œæ–°è¡¨åˆ›å»ºSQL
-- æ‰€æœ‰æ–°è¡¨éƒ½å¸¦ _new åç¼€ï¼Œé¿å…å†²çª
CREATE TABLE monitor_config_new (...);
CREATE TABLE monitor_task_new (...);
CREATE TABLE ws_batch_execution_new (...);
CREATE TABLE monitor_alert_log_new (...);
```

#### 1.2 æ•°æ®åˆ†æ
```sql
-- åˆ†æç°æœ‰é…ç½®ï¼Œæå–å”¯ä¸€é…ç½®
SELECT DISTINCT 
  time_interval,
  top_holders_threshold,
  events_config,
  trigger_logic,
  notify_methods,
  COUNT(*) as token_count
FROM sol_ws_batch_pool p
JOIN quick_monitor_template t ON p.template_id = t.id
GROUP BY time_interval, top_holders_threshold, events_config, trigger_logic, notify_methods;
```

### é˜¶æ®µ2ï¼šæ•°æ®è¿ç§»ï¼ˆ2-3å¤©ï¼‰

#### 2.1 è¿ç§»é…ç½® (quick_monitor_template â†’ monitor_config_new)

```sql
-- è¿ç§»é…ç½®æ•°æ®
INSERT INTO monitor_config_new (
  config_name,
  config_type,
  chain_type,
  time_interval,
  top_holders_threshold,
  events_config,
  trigger_logic,
  notify_methods,
  status,
  create_time
)
SELECT 
  config_name,
  source_type as config_type,
  chain_type,
  time_interval,
  top_holders_threshold,
  events_config,
  trigger_logic,
  notify_methods,
  status,
  create_time
FROM quick_monitor_template
WHERE del_flag = 0;

-- è®°å½•æ—§IDåˆ°æ–°IDçš„æ˜ å°„
CREATE TEMPORARY TABLE config_id_mapping (
  old_id BIGINT,
  new_id BIGINT
);
```

#### 2.2 è¿ç§»ä»»åŠ¡ (æŒ‰æ‰¹æ¬¡æå– â†’ monitor_task_new)

```sql
-- æ™ºèƒ½ç›‘æ§ä»»åŠ¡è¿ç§»
INSERT INTO monitor_task_new (
  task_name,
  task_type,
  config_id,
  chain_type,
  min_market_cap,
  max_market_cap,
  status,
  create_time
)
SELECT 
  CONCAT(t.config_name, ' - ', p.batch_id) as task_name,
  'smart' as task_type,
  m.new_id as config_id,
  p.chain_type,
  t.min_market_cap,
  NULL as max_market_cap,
  MAX(p.is_active) as status,
  MIN(p.create_time) as create_time
FROM sol_ws_batch_pool p
JOIN quick_monitor_template t ON p.template_id = t.id
JOIN config_id_mapping m ON t.id = m.old_id
WHERE p.source_type = 'smart'
GROUP BY p.batch_id, p.source_type, p.chain_type, p.template_id;

-- æ‰¹é‡ç›‘æ§ä»»åŠ¡è¿ç§»
INSERT INTO monitor_task_new (
  task_name,
  task_type,
  config_id,
  chain_type,
  ca_count,
  status,
  create_time
)
SELECT 
  CONCAT(t.config_name, ' - ', p.batch_id) as task_name,
  'batch' as task_type,
  m.new_id as config_id,
  p.chain_type,
  COUNT(*) as ca_count,
  MAX(p.is_active) as status,
  MIN(p.create_time) as create_time
FROM sol_ws_batch_pool p
JOIN quick_monitor_template t ON p.template_id = t.id
JOIN config_id_mapping m ON t.id = m.old_id
WHERE p.source_type = 'batch'
GROUP BY p.batch_id, p.source_type, p.chain_type, p.template_id;
```

#### 2.3 è¿ç§»Tokenæ˜ç»† (sol_ws_batch_pool â†’ ws_batch_execution_new)

```sql
-- è¿ç§»Tokenæ˜ç»†
INSERT INTO ws_batch_execution_new (
  task_id,
  task_type,
  batch_id,
  chain_type,
  ca,
  token_name,
  token_symbol,
  pair_address,
  market_cap,
  priority,
  sort_order,
  is_active,
  create_time
)
SELECT 
  task.id as task_id,
  p.source_type as task_type,
  p.batch_id,
  p.chain_type,
  p.ca,
  p.token_name,
  p.token_symbol,
  p.pair_address,
  p.market_cap,
  p.priority,
  p.sort_order,
  p.is_active,
  p.create_time
FROM sol_ws_batch_pool p
JOIN monitor_task_new task ON (
  task.chain_type = p.chain_type 
  AND task.task_name LIKE CONCAT('% - ', p.batch_id)
);
```

#### 2.4 æ•°æ®æ ¡éªŒ

```sql
-- æ ¡éªŒè®°å½•æ•°
SELECT 'monitor_config' as table_name, COUNT(*) as count FROM monitor_config_new
UNION ALL
SELECT 'monitor_task', COUNT(*) FROM monitor_task_new
UNION ALL
SELECT 'ws_batch_execution', COUNT(*) FROM ws_batch_execution_new;

-- æ ¡éªŒæ‰¹æ¬¡Tokenæ•°é‡
SELECT 
  task_id,
  batch_id,
  COUNT(*) as token_count
FROM ws_batch_execution_new
GROUP BY task_id, batch_id
HAVING token_count > 99;  -- æ£€æŸ¥æ˜¯å¦æœ‰è¶…è¿‡99ä¸ªçš„æ‰¹æ¬¡
```

### é˜¶æ®µ3ï¼šåŒå†™è¿‡æ¸¡ï¼ˆ1å‘¨ï¼‰

#### 3.1 ä¿®æ”¹Javaåç«¯ä»£ç 

```java
// BatchMonitorServiceImpl.java
@Service
public class BatchMonitorServiceImpl implements IBatchMonitorService {
    
    @Autowired
    private MonitorConfigMapper configMapper;  // æ–°Mapper
    
    @Autowired
    private MonitorTaskMapper taskMapper;      // æ–°Mapper
    
    @Autowired
    private WsBatchExecutionMapper executionMapper;  // æ–°Mapper
    
    // åŒå†™æ¨¡å¼
    private boolean DUAL_WRITE_MODE = true;  // é…ç½®å¼€å…³
    
    @Override
    public Map<String, Object> smartBatchAdd(List<String> addresses, Map<String, Object> config) {
        // 1. å†™å…¥æ–°è¡¨
        Long taskId = saveToNewTables(addresses, config);
        
        // 2. å¦‚æœå¼€å¯åŒå†™ï¼ŒåŒæ—¶å†™å…¥æ—§è¡¨ï¼ˆå…¼å®¹Pythonï¼‰
        if (DUAL_WRITE_MODE) {
            saveToOldTables(addresses, config);
        }
        
        return result;
    }
}
```

#### 3.2 ä¿®æ”¹Pythonç›‘æ§è„šæœ¬

```python
# monitor_service.py
class MonitorService:
    def __init__(self):
        self.use_new_schema = os.getenv('USE_NEW_SCHEMA', 'false') == 'true'
    
    def load_monitoring_tasks(self):
        if self.use_new_schema:
            return self._load_from_new_tables()
        else:
            return self._load_from_old_tables()
    
    def _load_from_new_tables(self):
        """ä»æ–°è¡¨ç»“æ„åŠ è½½ä»»åŠ¡"""
        query = """
        SELECT 
          t.id as task_id,
          t.task_type,
          t.chain_type,
          c.time_interval,
          c.events_config,
          c.trigger_logic,
          c.notify_methods,
          e.batch_id,
          e.ca,
          e.token_name
        FROM monitor_task t
        JOIN monitor_config c ON t.config_id = c.id
        JOIN ws_batch_execution e ON t.id = e.task_id
        WHERE t.status = 1 AND e.is_active = 1
        """
        return self.db.execute(query)
    
    def _load_from_old_tables(self):
        """ä»æ—§è¡¨ç»“æ„åŠ è½½ä»»åŠ¡ï¼ˆå…¼å®¹ï¼‰"""
        query = """
        SELECT 
          p.batch_id,
          p.chain_type,
          p.ca,
          t.time_interval,
          t.events_config,
          t.trigger_logic,
          t.notify_methods
        FROM sol_ws_batch_pool p
        JOIN quick_monitor_template t ON p.template_id = t.id
        WHERE p.is_active = 1
        """
        return self.db.execute(query)
```

### é˜¶æ®µ4ï¼šåˆ‡æ¢éªŒè¯ï¼ˆ3-5å¤©ï¼‰

#### 4.1 ç°åº¦åˆ‡æ¢

**ç¬¬1å¤©ï¼š10%æµé‡**
```properties
# application.properties
monitor.use.new.schema=false
monitor.dual.write=true

# Pythonç¯å¢ƒå˜é‡
USE_NEW_SCHEMA=false
```

**ç¬¬2å¤©ï¼š50%æµé‡**
```properties
# éƒ¨åˆ†Pythonå®ä¾‹åˆ‡æ¢åˆ°æ–°è¡¨
USE_NEW_SCHEMA=true  # 50%å®ä¾‹
USE_NEW_SCHEMA=false # 50%å®ä¾‹
```

**ç¬¬3å¤©ï¼š100%æµé‡**
```properties
# å…¨éƒ¨åˆ‡æ¢åˆ°æ–°è¡¨
monitor.use.new.schema=true
USE_NEW_SCHEMA=true
```

#### 4.2 ç›‘æ§æŒ‡æ ‡

```sql
-- æ¯å°æ—¶æ‰§è¡Œï¼Œå¯¹æ¯”æ–°æ—§è¡¨æ•°æ®
SELECT 
  'old_active_batches' as metric,
  COUNT(DISTINCT CONCAT(batch_id, '_', chain_type)) as value
FROM sol_ws_batch_pool
WHERE is_active = 1

UNION ALL

SELECT 
  'new_active_tasks' as metric,
  COUNT(*) as value
FROM monitor_task_new
WHERE status = 1;

-- å‘Šè­¦æ•°é‡å¯¹æ¯”
SELECT 
  DATE(create_time) as date,
  'old' as source,
  COUNT(*) as alert_count
FROM token_monitor_alert_log
WHERE create_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY DATE(create_time)

UNION ALL

SELECT 
  DATE(create_time) as date,
  'new' as source,
  COUNT(*) as alert_count
FROM monitor_alert_log_new
WHERE create_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY DATE(create_time);
```

### é˜¶æ®µ5ï¼šå®Œæˆè¿ç§»ï¼ˆ1å¤©ï¼‰

#### 5.1 é‡å‘½åè¡¨

```sql
-- å¤‡ä»½æ—§è¡¨
RENAME TABLE quick_monitor_template TO quick_monitor_template_backup;
RENAME TABLE sol_ws_batch_pool TO sol_ws_batch_pool_backup;

-- æ–°è¡¨å»æ‰ _new åç¼€
RENAME TABLE monitor_config_new TO monitor_config;
RENAME TABLE monitor_task_new TO monitor_task;
RENAME TABLE ws_batch_execution_new TO ws_batch_execution;
RENAME TABLE monitor_alert_log_new TO monitor_alert_log;
```

#### 5.2 æ¸…ç†ä»£ç 

```java
// ç§»é™¤åŒå†™é€»è¾‘
private boolean DUAL_WRITE_MODE = false;  // å…³é—­

// åˆ é™¤æ—§Mapperå¼•ç”¨
// @Autowired
// private SolWsBatchPoolMapper oldMapper;  // åˆ é™¤
```

```python
# ç§»é™¤æ—§è¡¨é€»è¾‘
def load_monitoring_tasks(self):
    return self._load_from_new_tables()  # åªä¿ç•™æ–°é€»è¾‘
```

#### 5.3 è§‚å¯ŸæœŸï¼ˆ1å‘¨ï¼‰

- ç›‘æ§å‘Šè­¦æ•°é‡æ˜¯å¦æ­£å¸¸
- ç›‘æ§ä»»åŠ¡æ‰§è¡Œæ˜¯å¦æ­£å¸¸
- ç”¨æˆ·åé¦ˆæ˜¯å¦æœ‰å¼‚å¸¸
- æ€§èƒ½æŒ‡æ ‡æ˜¯å¦æ”¹å–„

#### 5.4 åˆ é™¤æ—§è¡¨ï¼ˆ1ä¸ªæœˆåï¼‰

```sql
-- ç¡®è®¤æ— é—®é¢˜åï¼Œåˆ é™¤å¤‡ä»½è¡¨
DROP TABLE IF EXISTS quick_monitor_template_backup;
DROP TABLE IF EXISTS sol_ws_batch_pool_backup;
DROP TABLE IF EXISTS token_monitor_alert_log;  -- å¦‚æœæœ‰çš„è¯
```

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•è®¡åˆ’

### æµ‹è¯•åœºæ™¯

| åœºæ™¯ | æ•°æ®é‡ | å¹¶å‘æ•° | é¢„æœŸå“åº”æ—¶é—´ | å‹æµ‹å·¥å…· |
|------|--------|--------|--------------|----------|
| æŸ¥è¯¢æ´»è·ƒä»»åŠ¡åˆ—è¡¨ | 2000æ¡ | 100 QPS | < 50ms | JMeter |
| æŸ¥è¯¢å•ä¸ªä»»åŠ¡é…ç½® | - | 500 QPS | < 10ms | ab |
| åˆ›å»ºæ‰¹é‡ç›‘æ§ä»»åŠ¡ | 99ä¸ªCA | 10 QPS | < 200ms | JMeter |
| æ‰¹é‡æ›´æ–°æ‰§è¡ŒçŠ¶æ€ | 99æ¡/æ‰¹ | 50 QPS | < 100ms | ab |
| å‘Šè­¦æ—¥å¿—å†™å…¥ | - | 200 QPS | < 50ms | JMeter |

### å‹æµ‹è„šæœ¬ç¤ºä¾‹

```bash
# 1. æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨
ab -n 10000 -c 100 http://localhost:8080/api/monitor/tasks

# 2. å•ä»»åŠ¡é…ç½®æŸ¥è¯¢
ab -n 50000 -c 500 http://localhost:8080/api/monitor/tasks/1

# 3. JMeteræ‰¹é‡ä»»åŠ¡åˆ›å»º
# - å‡†å¤‡ 1000 ä¸ªä¸åŒçš„ CA åˆ—è¡¨
# - å¹¶å‘ 10 çº¿ç¨‹
# - å¾ªç¯ 100 æ¬¡
```

### æ€§èƒ½åŸºçº¿å¯¹æ¯”

| æŒ‡æ ‡ | æ—§æ¶æ„ | æ–°æ¶æ„ | æå‡ |
|------|--------|--------|------|
| é…ç½®æŸ¥è¯¢ | ~200ms (JOIN+GROUP BY) | ~10ms (ç›´æ¥æŸ¥è¯¢) | **95%â†‘** |
| æ‰¹æ¬¡åˆ—è¡¨ | ~500ms (å¤æ‚GROUP BY) | ~50ms (å•è¡¨æŸ¥è¯¢) | **90%â†‘** |
| å‘Šè­¦å†™å…¥ | ~80ms | ~30ms | **62.5%â†‘** |
| æ•°æ®å†—ä½™ç‡ | 98% | 2% | **96%â†“** |

### ç›‘æ§å¤§ç›˜ï¼ˆGrafanaï¼‰

#### å…³é”®æŒ‡æ ‡

**1. æ•°æ®ä¸€è‡´æ€§æŒ‡æ ‡**
```promql
# æ–°æ—§è¡¨ä»»åŠ¡æ•°é‡å·®å¼‚
abs(old_table_task_count - new_table_task_count)

# å‘Šè­¦æ•°é‡å·®å¼‚
abs(old_alert_count - new_alert_count)
```

**2. æ€§èƒ½æŒ‡æ ‡**
- API å“åº”æ—¶é—´ P50/P95/P99
- æ•°æ®åº“æ…¢æŸ¥è¯¢æ•°é‡ï¼ˆ>100msï¼‰
- Redis ç¼“å­˜å‘½ä¸­ç‡

**3. ä¸šåŠ¡æŒ‡æ ‡**
- æ´»è·ƒä»»åŠ¡æ•°
- æ¯å°æ—¶å‘Šè­¦æ•°
- æ‰¹æ¬¡æ‰§è¡ŒæˆåŠŸç‡
- Worker å¿ƒè·³è¶…æ—¶æ¬¡æ•°

#### å‘Šè­¦è§„åˆ™

```yaml
groups:
  - name: monitor_migration
    rules:
      - alert: DataInconsistency
        expr: abs(old_table_count - new_table_count) > 10
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "æ–°æ—§è¡¨æ•°æ®ä¸ä¸€è‡´è¶…è¿‡10æ¡"
      
      - alert: PerformanceDegradation
        expr: api_response_time_p95 > 200
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "API P95å“åº”æ—¶é—´è¶…è¿‡200ms"
      
      - alert: WorkerHeartbeatTimeout
        expr: time() - monitor_batch.last_heartbeat > 60
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Workerå¿ƒè·³è¶…æ—¶ï¼Œæ‰¹æ¬¡å¯èƒ½å¼‚å¸¸"
```

---

## ğŸ“… å®æ–½è·¯çº¿å›¾

| é˜¶æ®µ | å·¥ä½œå†…å®¹ | é¢„è®¡æ—¶é—´ | è´£ä»»äºº | é£é™©ç­‰çº§ |
|------|---------|----------|--------|----------|
| **å‡†å¤‡** | åˆ›å»ºæ–°è¡¨ã€æ•°æ®åˆ†æ | 1å¤© | Backend | ä½ |
| **è¿ç§»** | æ•°æ®è¿ç§»ã€æ ¡éªŒ | 2-3å¤© | Backend | ä¸­ |
| **åŒå†™** | ä»£ç æ”¹é€ ã€æµ‹è¯• | 1å‘¨ | Backend + Python | ä¸­ |
| **åˆ‡æ¢** | ç°åº¦åˆ‡æ¢ã€ç›‘æ§ | 3-5å¤© | Backend + Python + è¿ç»´ | é«˜ |
| **å®Œæˆ** | é‡å‘½åè¡¨ã€æ¸…ç†ä»£ç  | 1å¤© | Backend | ä½ |
| **è§‚å¯Ÿ** | ç›‘æ§æ•°æ®ã€ç”¨æˆ·åé¦ˆ | 1å‘¨ | å…¨å‘˜ | ä¸­ |
| **æ¸…ç†** | åˆ é™¤æ—§è¡¨ | 1å¤© | DBA | ä½ |

**æ€»è®¡ï¼šçº¦ 2-3 å‘¨å®Œæˆè¿ç§»**

---

## âš ï¸ é£é™©è¯„ä¼°

### é«˜é£é™©é¡¹

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| æ•°æ®è¿ç§»é”™è¯¯ | ç›‘æ§å¤±æ•ˆ | ä¸­ | åŒå†™+æ ¡éªŒ+ç°åº¦ |
| Pythonè„šæœ¬å…¼å®¹æ€§ | ç›‘æ§ä¸­æ–­ | é«˜ | ä¿ç•™æ—§è¡¨è¯»å–é€»è¾‘ |
| æ€§èƒ½ä¸‹é™ | ç³»ç»Ÿå¡é¡¿ | ä½ | æå‰å‹æµ‹+ç´¢å¼•ä¼˜åŒ– |
| å‘Šè­¦é—æ¼ | ç”¨æˆ·æŠ•è¯‰ | ä¸­ | åŒå†™æœŸå¯¹æ¯”å‘Šè­¦æ•° |

### ä¸­é£é™©é¡¹

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| æ‰¹æ¬¡IDå†²çª | æ•°æ®æ··ä¹± | ä½ | è¿ç§»æ—¶é‡æ–°åˆ†é…ID |
| é…ç½®ä¸¢å¤± | éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆ | ä½ | è¿ç§»å‰å¯¼å‡ºé…ç½®å¤‡ä»½ |
| Redisç¼“å­˜ä¸ä¸€è‡´ | æ•°æ®ä¸åŒæ­¥ | ä¸­ | åˆ‡æ¢æ—¶æ¸…ç©ºRedis |

### ä½é£é™©é¡¹

- å‰ç«¯æ˜¾ç¤ºå¼‚å¸¸ï¼ˆå½±å“å°ï¼Œå¯å¿«é€Ÿä¿®å¤ï¼‰
- æ–‡æ¡£ä¸åŒæ­¥ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- æ—§APIè°ƒç”¨å¤±è´¥ï¼ˆå·²åºŸå¼ƒAPIï¼‰

---

## ğŸ”™ å›æ»šæ–¹æ¡ˆ

### åœºæ™¯1ï¼šæ•°æ®è¿ç§»é˜¶æ®µå‘ç°é—®é¢˜

**æ“ä½œï¼š**
```sql
-- ç›´æ¥åˆ é™¤æ–°è¡¨é‡æ–°è¿ç§»
DROP TABLE monitor_config_new;
DROP TABLE monitor_task_new;
DROP TABLE ws_batch_execution_new;
DROP TABLE monitor_alert_log_new;
```

**å½±å“ï¼š** æ— ï¼Œæ—§è¡¨æœªåŠ¨

### åœºæ™¯2ï¼šåŒå†™é˜¶æ®µå‘ç°é—®é¢˜

**æ“ä½œï¼š**
```properties
# å…³é—­åŒå†™ï¼Œåªå†™æ—§è¡¨
monitor.dual.write=false
```

**å½±å“ï¼š** æ–°è¡¨æ•°æ®å¯èƒ½ä¸å®Œæ•´ï¼Œä½†ä¸å½±å“ç°æœ‰åŠŸèƒ½

### åœºæ™¯3ï¼šåˆ‡æ¢åå‘ç°ä¸¥é‡é—®é¢˜

**æ“ä½œï¼š**
```properties
# ç´§æ€¥å›æ»šåˆ°æ—§è¡¨
monitor.use.new.schema=false
USE_NEW_SCHEMA=false

# Pythoné‡å¯æ‰€æœ‰å®ä¾‹
systemctl restart monitor-service
```

```sql
-- å¦‚æœæ–°è¡¨æ•°æ®æœ‰é—®é¢˜ï¼Œä»å¤‡ä»½è¡¨æ¢å¤
DROP TABLE monitor_config;
DROP TABLE monitor_task;
DROP TABLE ws_batch_execution;

RENAME TABLE quick_monitor_template_backup TO quick_monitor_template;
RENAME TABLE sol_ws_batch_pool_backup TO sol_ws_batch_pool;
```

**å½±å“ï¼š** åˆ‡æ¢æœŸé—´äº§ç”Ÿçš„æ–°æ•°æ®å¯èƒ½ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥å½•

### åœºæ™¯4ï¼šéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸

**æ“ä½œï¼š**
```properties
# é’ˆå¯¹ç‰¹å®šåŠŸèƒ½å›æ»š
monitor.smart.use.new.schema=false  # æ™ºèƒ½ç›‘æ§ç”¨æ—§è¡¨
monitor.batch.use.new.schema=true   # æ‰¹é‡ç›‘æ§ç”¨æ–°è¡¨
```

**å½±å“ï¼š** éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨æ—§é€»è¾‘ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### æŠ€æœ¯æ”¶ç›Š

| æŒ‡æ ‡ | å½“å‰ | ä¼˜åŒ–å | æå‡ |
|------|------|--------|------|
| é…ç½®æŸ¥è¯¢é€Ÿåº¦ | ~200ms | ~10ms | **95%â†‘** |
| æ‰¹æ¬¡åˆ—è¡¨æŸ¥è¯¢ | ~500ms (GROUP BY) | ~50ms (ç›´æ¥æŸ¥è¯¢) | **90%â†‘** |
| æ•°æ®å†—ä½™ç‡ | ~98% | ~2% | **96%â†“** |
| ä»£ç å¤æ‚åº¦ | é«˜ (å¤šè¡¨JOIN) | ä½ (ç®€å•å…³è”) | **æ˜æ˜¾é™ä½** |

### ä¸šåŠ¡æ”¶ç›Š

- âœ… **é…ç½®å¤ç”¨**ï¼šåˆ›å»ºä¸€æ¬¡é…ç½®ï¼Œå¤šä¸ªä»»åŠ¡å…±äº«
- âœ… **æ‰©å±•æ€§å¼º**ï¼šæ–°å¢ç›‘æ§ç±»å‹åªéœ€åŠ  task_type
- âœ… **ç»´æŠ¤ç®€å•**ï¼šè¡¨ç»“æ„æ¸…æ™°ï¼Œä»£ç é€»è¾‘ç®€å•
- âœ… **ç»Ÿä¸€å‘Šè­¦**ï¼šæ‰€æœ‰å‘Šè­¦åœ¨åŒä¸€å¼ è¡¨ï¼Œä¾¿äºåˆ†æ

---

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### Phase 2 - æ€§èƒ½ä¼˜åŒ–ï¼ˆè¿ç§»å1ä¸ªæœˆï¼‰

1. **ç´¢å¼•ä¼˜åŒ–**
   ```sql
   -- åˆ†ææ…¢æŸ¥è¯¢
   EXPLAIN SELECT ... FROM ws_batch_execution ...;
   
   -- æ·»åŠ ç»„åˆç´¢å¼•
   CREATE INDEX idx_task_batch_active 
   ON ws_batch_execution(task_id, batch_id, is_active);
   ```

2. **åˆ†åŒºè¡¨**ï¼ˆå¦‚æœæ•°æ®é‡å¢é•¿å¿«ï¼‰
   ```sql
   -- æŒ‰æœˆåˆ†åŒº
   ALTER TABLE monitor_alert_log
   PARTITION BY RANGE (TO_DAYS(create_time)) (
     PARTITION p202501 VALUES LESS THAN (TO_DAYS('2025-02-01')),
     PARTITION p202502 VALUES LESS THAN (TO_DAYS('2025-03-01')),
     ...
   );
   ```

### Phase 3 - åŠŸèƒ½å¢å¼ºï¼ˆè¿ç§»å2ä¸ªæœˆï¼‰

1. **é…ç½®æ¨¡æ¿å¸‚åœº**
   - ç”¨æˆ·å¯åˆ†äº«é…ç½®æ¨¡æ¿
   - ä¸€é”®åº”ç”¨å…¶ä»–ç”¨æˆ·çš„é…ç½®

2. **ä»»åŠ¡è°ƒåº¦ä¼˜åŒ–**
   - æ™ºèƒ½ä»»åŠ¡è‡ªåŠ¨åˆ·æ–°Tokenåˆ—è¡¨
   - æ‰¹æ¬¡åŠ¨æ€è°ƒæ•´ï¼ˆè‡ªåŠ¨åˆå¹¶/æ‹†åˆ†ï¼‰

3. **å‘Šè­¦è§„åˆ™å¼•æ“**
   - æ”¯æŒå¤æ‚çš„å‘Šè­¦æ¡ä»¶
   - å‘Šè­¦èšåˆï¼ˆé¿å…åˆ·å±ï¼‰

---

## ğŸ¤ å›¢é˜Ÿåä½œ

### éœ€è¦å‚ä¸çš„è§’è‰²

| è§’è‰² | èŒè´£ | å·¥ä½œé‡ |
|------|------|--------|
| **Backendå¼€å‘** | æ•°æ®è¿ç§»è„šæœ¬ã€Javaä»£ç æ”¹é€  | 5äººå¤© |
| **Pythonå¼€å‘** | ç›‘æ§è„šæœ¬é€‚é…æ–°è¡¨ç»“æ„ | 3äººå¤© |
| **Frontendå¼€å‘** | é¡µé¢é€‚é…ï¼ˆæœ€å°æ”¹åŠ¨ï¼‰ | 1äººå¤© |
| **DBA** | SQLå®¡æ ¸ã€æ•°æ®è¿ç§»æ‰§è¡Œ | 2äººå¤© |
| **è¿ç»´** | ç°åº¦å‘å¸ƒã€ç›‘æ§æŒ‡æ ‡ | 3äººå¤© |
| **æµ‹è¯•** | åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯• | 3äººå¤© |

**æ€»è®¡ï¼šçº¦ 17 äººå¤©**

---

## âœ… æ£€æŸ¥æ¸…å•

### è¿ç§»å‰æ£€æŸ¥

- [ ] æ–°è¡¨SQLå·²å®¡æ ¸
- [ ] æ•°æ®è¿ç§»è„šæœ¬å·²æµ‹è¯•
- [ ] æ•°æ®å¤‡ä»½å·²å®Œæˆ
- [ ] åŒå†™ä»£ç å·²å¼€å‘å®Œæˆ
- [ ] Pythonå…¼å®¹æ€§å·²ç¡®è®¤
- [ ] æµ‹è¯•ç¯å¢ƒå·²éªŒè¯é€šè¿‡

### è¿ç§»ä¸­æ£€æŸ¥

- [ ] æ•°æ®è¿ç§»å·²å®Œæˆ
- [ ] æ•°æ®æ ¡éªŒå·²é€šè¿‡
- [ ] åŒå†™æ¨¡å¼å·²å¼€å¯
- [ ] å‘Šè­¦æ•°é‡å¯¹æ¯”æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸

### è¿ç§»åæ£€æŸ¥

- [ ] æ‰€æœ‰ç›‘æ§ä»»åŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å‘Šè­¦é€šçŸ¥æ­£å¸¸å‘é€
- [ ] ç”¨æˆ·æ— å¼‚å¸¸åé¦ˆ
- [ ] æ€§èƒ½æœ‰æå‡
- [ ] æ—§è¡¨å·²å¤‡ä»½å¹¶åˆ é™¤

---

## ğŸ”§ è¿›é˜¶ä¼˜åŒ–ä¸ç”Ÿäº§åŠ å›º

### ğŸ“Š è¡¨ç»“æ„ä¸ç´¢å¼•å¾®è°ƒ

#### 1. ç›®æ ‡å±‚è¡¥å……é“¾è·¯ä¿¡æ¯ & è§„èŒƒåŒ–åœ°å€

**é—®é¢˜**: `monitor_task_target` ç›®å‰æ²¡æœ‰ `chain_type`ï¼ˆé ä»»åŠ¡ç»§æ‰¿ï¼‰ï¼Œæ¨èå†—ä½™ä¸€ä»½ä¾¿äºè·¨ä»»åŠ¡è¿ç»´/æ’éšœä¸ç‹¬ç«‹æŸ¥è¯¢ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- åœ°å€è§„èŒƒåŒ–ï¼š
-- EVM ç”¨ LOWER() å­˜å‚¨ï¼Œåˆ—å‹ CHAR(42)
-- Solana base58 é•¿åº¦ä¸å®šï¼Œåˆ—å‹ VARCHAR(64) è¶³å¤Ÿ

ALTER TABLE monitor_task_target 
  ADD COLUMN chain_type VARCHAR(10) NULL COMMENT 'é“¾ç±»å‹ï¼ˆå†—ä½™ä¾¿äºæŸ¥è¯¢ï¼‰' AFTER task_id,
  ADD INDEX idx_task_active_batch (task_id, status, batch_id),
  ADD INDEX idx_chain_target (chain_type, target_value);

-- æ•°æ®å›å¡«
UPDATE monitor_task_target tt
JOIN monitor_task t ON tt.task_id = t.id
SET tt.chain_type = t.chain_type;

-- EVM åœ°å€è§„èŒƒåŒ–å­˜å‚¨
UPDATE monitor_task_target
SET target_value = LOWER(target_value)
WHERE chain_type IN ('bsc', 'eth', 'polygon')
  AND target_type = 'ca';
```

#### 2. é…ç½®ç‰ˆæœ¬è¿½è¸ªåˆ°å‘Šè­¦

**é—®é¢˜**: å‘Šè­¦å›æº¯éœ€è¦çŸ¥é“è§¦å‘æ—¶çš„é…ç½®ç‰ˆæœ¬ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
ALTER TABLE monitor_alert_log 
  ADD COLUMN config_version INT NULL COMMENT 'è§¦å‘æ—¶çš„é…ç½®ç‰ˆæœ¬' AFTER config_id;
```

#### 3. æ‰¹æ¬¡å”¯ä¸€æ€§ä¸åæŸ¥ä¼˜åŒ–

**é—®é¢˜**: ç°åœ¨æ‰¹æ¬¡é¡¹èƒ½åæŸ¥ç›®æ ‡ï¼Œä½†ç›®æ ‡åæŸ¥æ‰¹æ¬¡å¤´è¦å¤šè·³ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
ALTER TABLE monitor_batch_item 
  ADD COLUMN task_id BIGINT NULL COMMENT 'ä»»åŠ¡IDï¼ˆå†—ä½™åŠ é€ŸåæŸ¥ï¼‰',
  ADD COLUMN batch_no INT NULL COMMENT 'æ‰¹æ¬¡å·ï¼ˆå†—ä½™åŠ é€ŸåæŸ¥ï¼‰',
  ADD UNIQUE KEY uk_task_batch_target (task_id, batch_no, target_id);

-- æ•°æ®å›å¡«
UPDATE monitor_batch_item bi
JOIN monitor_batch b ON bi.batch_id = b.id
SET bi.task_id = b.task_id, bi.batch_no = b.batch_no;
```

#### 4. JSON å¯æ£€ç´¢å­—æ®µç”Ÿæˆåˆ—ï¼ˆMySQL 8.0+ï¼‰

**é—®é¢˜**: å¸¸ç”¨é˜ˆå€¼åšç”Ÿæˆåˆ— + ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
ALTER TABLE monitor_config 
  ADD COLUMN price_rise_pct DECIMAL(10,4)
    GENERATED ALWAYS AS (JSON_EXTRACT(events_config, '$.priceChange.risePercent')) STORED
    COMMENT 'ä»·æ ¼ä¸Šæ¶¨ç™¾åˆ†æ¯”ï¼ˆç”Ÿæˆåˆ—ï¼‰',
  ADD COLUMN vol_threshold_usd DECIMAL(20,4)
    GENERATED ALWAYS AS (JSON_EXTRACT(events_config, '$.volume.thresholdUsd')) STORED
    COMMENT 'äº¤æ˜“é‡é˜ˆå€¼USDï¼ˆç”Ÿæˆåˆ—ï¼‰',
  ADD INDEX idx_price_rule (price_rise_pct),
  ADD INDEX idx_vol_rule (vol_threshold_usd);
```

#### 5. å‘Šè­¦å»é‡é”®æ›´ç¨³

**é—®é¢˜**: ç›®å‰å»é‡é”®æ˜¯ `task_id+ca+alert_type+date`ï¼Œéœ€åŠ  `config_id|config_version` æ›´ç²¾å‡†ï¼›åŒæ—¶ block ç±»å¯èƒ½æ—  caã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
ALTER TABLE monitor_alert_log 
  ADD COLUMN event_key VARCHAR(64) NULL COMMENT 'åŒºå—ç±»äº‹ä»¶å”¯ä¸€é”®ï¼ˆæ— caæ—¶ä½¿ç”¨ï¼‰';

-- ç”Ÿæˆ alert_key æ—¶ï¼š
-- MD5(task_id|config_id|config_version|COALESCE(ca,event_key)|alert_type|date)
```

**Python å®ç°**:

```python
def generate_alert_key(task_id, config_id, config_version, ca, event_key, alert_type):
    """ç”Ÿæˆå‘Šè­¦å»é‡é”®"""
    date_str = datetime.now().strftime('%Y-%m-%d')
    target = ca if ca else event_key
    raw = f"{task_id}|{config_id}|{config_version}|{target}|{alert_type}|{date_str}"
    return hashlib.md5(raw.encode()).hexdigest()
```

### âš™ï¸ åˆ†æ‰¹ä¸æ‰§è¡Œç»†èŠ‚ä¼˜åŒ–

#### 1. ä¸€è‡´æ€§å“ˆå¸Œç›å€¼ç‰ˆæœ¬ç®¡ç†

**æ–¹æ¡ˆ**: æŒ‰ `hash(task_id + target_value + salt_v1)` ç”Ÿæˆï¼Œæœªæ¥è‹¥è¿ç§»ç®—æ³•ï¼Œå˜æ›´ `salt_v2` åªå½±å“æ–°ç›®æ ‡ï¼Œè€æ‰¹æ¬¡ç¨³å®šã€‚

```python
# é…ç½®ä¸­å¿ƒ
HASH_SALT_VERSION = "v1"
HASH_SALTS = {
    "v1": "kakarot_2025",
    "v2": "kakarot_2026_new"  # æœªæ¥å‡çº§ç”¨
}

def calculate_batch_id(task_id: int, target_value: str, salt_version: str = "v1") -> int:
    """è®¡ç®—æ‰¹æ¬¡IDï¼ˆæ”¯æŒç›å€¼ç‰ˆæœ¬ï¼‰"""
    salt = HASH_SALTS.get(salt_version, HASH_SALTS["v1"])
    hash_input = f"{task_id}:{target_value}:{salt}"
    hash_value = hashlib.md5(hash_input.encode()).hexdigest()
    return int(hash_value[:8], 16) % MAX_BATCH_PER_TASK

# è¿ç§»æ—¶ï¼šæ–°ç›®æ ‡ç”¨ v2ï¼Œè€ç›®æ ‡ä¿æŒ v1
```

#### 2. ç¡¬çº¦æŸ â‰¤99/æ‰¹ï¼ˆæ•°æ®åº“ä¿æŠ¤ï¼‰

**æ–¹æ¡ˆ**: DB ä¾§æ— æ³•ç›´æ¥ CHECKï¼Œå¯åœ¨å†™å…¥æ‰¹æ¬¡é¡¹æ—¶åšä¿æŠ¤æ€§æ–­è¨€ï¼ˆäº‹åŠ¡å†…è®¡æ•° + å¤±è´¥å›æ»šï¼‰ã€‚

```python
def add_target_to_batch(conn, batch_id, target_id, item_order):
    """æ·»åŠ ç›®æ ‡åˆ°æ‰¹æ¬¡ï¼ˆå¸¦è®¡æ•°ä¿æŠ¤ï¼‰"""
    with conn.cursor() as cursor:
        # æ£€æŸ¥å½“å‰æ‰¹æ¬¡æ•°é‡
        cursor.execute("""
            SELECT item_count FROM monitor_batch 
            WHERE id = %s FOR UPDATE
        """, (batch_id,))
        current_count = cursor.fetchone()[0]
        
        if current_count >= 99:
            raise ValueError(f"æ‰¹æ¬¡ {batch_id} å·²æ»¡ï¼ˆ{current_count}/99ï¼‰")
        
        # æ’å…¥æ‰¹æ¬¡é¡¹
        cursor.execute("""
            INSERT INTO monitor_batch_item (batch_id, target_id, item_order)
            VALUES (%s, %s, %s)
        """, (batch_id, target_id, item_order))
        
        # æ›´æ–°æ‰¹æ¬¡å¤´è®¡æ•°
        cursor.execute("""
            UPDATE monitor_batch SET item_count = item_count + 1
            WHERE id = %s
        """, (batch_id,))
    
    conn.commit()
```

#### 3. æ‰¹æ¬¡å¿ƒè·³ä¸å­¤å„¿æ‰¹æ¬¡å›æ”¶

**æ–¹æ¡ˆ**: å¿ƒè·³è¶…æ—¶è‡ªåŠ¨ `status=paused`ï¼Œå¹¶å‘èµ·å­¤å„¿æ‰¹æ¬¡å›æ”¶ï¼ˆå¹‚ç­‰é‡ç»‘åˆ°ç©ºé—² workerï¼‰ã€‚

```python
def orphan_batch_recovery():
    """å­¤å„¿æ‰¹æ¬¡å›æ”¶ï¼ˆå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿæ‰§è¡Œï¼‰"""
    HEARTBEAT_TIMEOUT = 300  # 5åˆ†é’Ÿæ— å¿ƒè·³è§†ä¸ºå­¤å„¿
    
    # æŸ¥æ‰¾å­¤å„¿æ‰¹æ¬¡
    orphan_batches = db.execute("""
        SELECT id, task_id, batch_no, worker_id
        FROM monitor_batch
        WHERE status = 'running'
          AND TIMESTAMPDIFF(SECOND, last_heartbeat, NOW()) > %s
    """, (HEARTBEAT_TIMEOUT,))
    
    for batch in orphan_batches:
        logger.warning(f"ğŸš¨ å‘ç°å­¤å„¿æ‰¹æ¬¡: {batch['id']}, worker={batch['worker_id']}")
        
        # æš‚åœæ‰¹æ¬¡
        db.execute("""
            UPDATE monitor_batch
            SET status = 'paused',
                error_message = CONCAT('å¿ƒè·³è¶…æ—¶ï¼Œä¸Šæ¬¡å¿ƒè·³: ', last_heartbeat)
            WHERE id = %s
        """, (batch['id'],))
        
        # å‘é€å‘Šè­¦
        send_alert(f"æ‰¹æ¬¡ {batch['id']} å¿ƒè·³è¶…æ—¶ï¼Œå·²è‡ªåŠ¨æš‚åœ")
```

### ğŸ”„ å˜æ›´æ„ŸçŸ¥ä¸çƒ­æ›´æ–°å¢å¼º

#### 1. å»æŠ–çª—å£ï¼ˆ2ç§’èšåˆï¼‰

**æ–¹æ¡ˆ**: åŒä¸€ task çš„å¤šæ¬¡ç¼–è¾‘åœ¨ 2 ç§’å†…èšåˆä¸ºä¸€æ¬¡é‡è½½ã€‚

```python
from collections import defaultdict
import threading

class ConfigChangeDebouncer:
    """é…ç½®å˜æ›´å»æŠ–å™¨"""
    def __init__(self, delay=2.0):
        self.delay = delay
        self.pending = defaultdict(lambda: None)  # task_id -> Timer
        self.lock = threading.Lock()
    
    def trigger(self, task_id: int):
        """è§¦å‘é…ç½®å˜æ›´ï¼ˆå»æŠ–ï¼‰"""
        with self.lock:
            # å–æ¶ˆä¹‹å‰çš„å®šæ—¶å™¨
            if self.pending[task_id]:
                self.pending[task_id].cancel()
            
            # è®¾ç½®æ–°å®šæ—¶å™¨
            timer = threading.Timer(self.delay, self._do_reload, args=(task_id,))
            self.pending[task_id] = timer
            timer.start()
            
            logger.debug(f"â³ ä»»åŠ¡ {task_id} é…ç½®å˜æ›´ï¼Œ{self.delay}ç§’åé‡è½½")
    
    def _do_reload(self, task_id: int):
        """æ‰§è¡Œé‡è½½"""
        with self.lock:
            self.pending.pop(task_id, None)
        
        logger.info(f"ğŸ”„ é‡è½½ä»»åŠ¡ {task_id} é…ç½®")
        reload_task_config(task_id)

# ä½¿ç”¨
debouncer = ConfigChangeDebouncer(delay=2.0)

def on_redis_message(message):
    task_id = int(message['data'])
    debouncer.trigger(task_id)
```

#### 2. åŸå­åˆ‡æ¢ï¼ˆé¿å…åŠé…ç½®ï¼‰

**æ–¹æ¡ˆ**: ä»»åŠ¡ç¼–è¾‘å¤šè¡¨å†™æ—¶ï¼Œå°† `monitor_task.status='updating'`ï¼Œå…¨éƒ¨å†™å®Œå `enabled`ï¼Œç›‘æ§ç«¯è§åˆ° `updating` ç›´æ¥è·³è¿‡ã€‚

```python
def update_task_with_configs(task_id: int, task_data: dict, configs: list):
    """åŸå­æ›´æ–°ä»»åŠ¡å’Œé…ç½®"""
    with db.transaction():
        # 1. æ ‡è®°ä»»åŠ¡ä¸ºæ›´æ–°ä¸­
        db.execute("""
            UPDATE monitor_task
            SET status = 'updating', update_time = NOW()
            WHERE id = %s
        """, (task_id,))
        
        # 2. æ›´æ–°ä»»åŠ¡åŸºæœ¬ä¿¡æ¯
        db.execute("""
            UPDATE monitor_task
            SET task_name = %s, remark = %s
            WHERE id = %s
        """, (task_data['name'], task_data['remark'], task_id))
        
        # 3. æ‰¹é‡æ›´æ–°é…ç½®
        for config in configs:
            db.execute("""
                UPDATE monitor_task_config
                SET config_id = %s, weight = %s
                WHERE task_id = %s AND config_id = %s
            """, (config['id'], config['weight'], task_id, config['old_id']))
        
        # 4. æ¢å¤ä»»åŠ¡çŠ¶æ€
        db.execute("""
            UPDATE monitor_task
            SET status = 'enabled', update_time = NOW()
            WHERE id = %s
        """, (task_id,))
        
        # 5. å‘å¸ƒé…ç½®å˜æ›´äº‹ä»¶
        redis.publish('monitor:config:change', task_id)
    
    logger.info(f"âœ… ä»»åŠ¡ {task_id} é…ç½®åŸå­æ›´æ–°å®Œæˆ")
```

**ç›‘æ§ç«¯å¤„ç†**:

```python
def load_task_configs(task_id: int):
    """åŠ è½½ä»»åŠ¡é…ç½®ï¼ˆè·³è¿‡æ›´æ–°ä¸­çš„ä»»åŠ¡ï¼‰"""
    task = db.fetchone("""
        SELECT id, status FROM monitor_task WHERE id = %s
    """, (task_id,))
    
    if task['status'] == 'updating':
        logger.debug(f"â¸ï¸ ä»»åŠ¡ {task_id} æ­£åœ¨æ›´æ–°ä¸­ï¼Œè·³è¿‡æœ¬è½®")
        return None
    
    # æ­£å¸¸åŠ è½½é…ç½®
    return load_configs_for_task(task_id)
```

### ğŸšš è¿ç§»è„šæœ¬å¯¹é½ v2.0ï¼ˆå…³é”®æ›´æ­£ï¼‰

**é—®é¢˜**: æ–‡æ¡£ä¸­è¿ç§»ä»å¼•ç”¨äº† `ws_batch_execution_new`ï¼ˆv1 é—ç•™ï¼‰ï¼Œåº”æ”¹ä¸º v2.0 çš„ç›®æ ‡ â†’ åˆ†æ‰¹ â†’ æ‰¹æ¬¡å¤´/é¡¹ä¸‰æ­¥ã€‚

**æ­£ç¡®çš„è¿ç§»æ­¥éª¤**:

```sql
-- ============================================================
-- æ­¥éª¤ 2.3: è¿ç§» Token åˆ°ç›®æ ‡å±‚
-- ============================================================
INSERT INTO monitor_task_target (
    task_id, target_type, target_value, token_name, token_symbol, 
    market_cap, source, status, create_time
)
SELECT 
    task.id,
    'ca',
    p.ca,
    p.token_name,
    p.token_symbol,
    p.market_cap,
    p.source_type,
    p.is_active,
    p.create_time
FROM sol_ws_batch_pool p
JOIN monitor_task task
  ON task.chain_type = p.chain_type
 AND task.task_type  = p.source_type
 AND task.task_name LIKE CONCAT('% - ', p.batch_id);

-- ============================================================
-- æ­¥éª¤ 2.4: æ‰¹æ¬¡åˆ†é…ï¼ˆç¦»çº¿æ‰¹å¤„ç†è„šæœ¬æ‰§è¡Œä¸€æ¬¡ï¼‰
-- ============================================================
-- ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œæ–¹æ³•è®¡ç®— batch_no & item_order
-- å›å†™ monitor_task_target.batch_id, batch_order

-- Python è„šæœ¬
```

```python
# batch_allocation.py
def allocate_batches_for_all_tasks():
    """ä¸ºæ‰€æœ‰ä»»åŠ¡çš„ç›®æ ‡åˆ†é…æ‰¹æ¬¡"""
    tasks = db.fetchall("SELECT id FROM monitor_task WHERE status = 'enabled'")
    
    for task in tasks:
        task_id = task['id']
        targets = db.fetchall("""
            SELECT id, target_value FROM monitor_task_target
            WHERE task_id = %s AND status = 1
        """, (task_id,))
        
        # æŒ‰ä¸€è‡´æ€§å“ˆå¸Œåˆ†æ‰¹
        batch_assignments = {}
        for target in targets:
            batch_no = calculate_batch_id(task_id, target['target_value'])
            if batch_no not in batch_assignments:
                batch_assignments[batch_no] = []
            batch_assignments[batch_no].append(target['id'])
        
        # å›å†™æ‰¹æ¬¡å·å’Œé¡ºåº
        for batch_no, target_ids in batch_assignments.items():
            for order, target_id in enumerate(target_ids, 1):
                db.execute("""
                    UPDATE monitor_task_target
                    SET batch_id = %s, batch_order = %s
                    WHERE id = %s
                """, (batch_no, order, target_id))
        
        logger.info(f"âœ… ä»»åŠ¡ {task_id} åˆ†é…äº† {len(batch_assignments)} ä¸ªæ‰¹æ¬¡")

if __name__ == '__main__':
    allocate_batches_for_all_tasks()
```

```sql
-- ============================================================
-- æ­¥éª¤ 2.5: å†™å…¥æ‰¹æ¬¡å¤´/é¡¹
-- ============================================================

-- 2.5.1 åˆ›å»ºæ‰¹æ¬¡å¤´
INSERT INTO monitor_batch (task_id, batch_no, item_count, status, create_time)
SELECT 
    task_id,
    batch_id,
    COUNT(*),
    'pending',
    NOW()
FROM monitor_task_target
WHERE status = 1 AND batch_id IS NOT NULL
GROUP BY task_id, batch_id;

-- 2.5.2 åˆ›å»ºæ‰¹æ¬¡é¡¹
INSERT INTO monitor_batch_item (
    batch_id, target_id, item_order, task_id, batch_no, ca
)
SELECT 
    mb.id,
    t.id,
    t.batch_order,
    t.task_id,
    t.batch_id,
    t.target_value
FROM monitor_task_target t
JOIN monitor_batch mb
  ON mb.task_id = t.task_id AND mb.batch_no = t.batch_id
WHERE t.status = 1 AND t.batch_id IS NOT NULL;

-- ============================================================
-- æ­¥éª¤ 2.6: æ•°æ®æ ¡éªŒ
-- ============================================================

-- æ ¡éªŒç›®æ ‡æ•°é‡
SELECT 'ç›®æ ‡å±‚æ•°é‡' AS stage, COUNT(*) AS count FROM monitor_task_target
UNION ALL
SELECT 'æ‰¹æ¬¡é¡¹æ•°é‡' AS stage, COUNT(*) AS count FROM monitor_batch_item;

-- æ ¡éªŒæ‰¹æ¬¡å®Œæ•´æ€§
SELECT 
    mb.id AS batch_id,
    mb.item_count AS declared_count,
    COUNT(mbi.id) AS actual_count
FROM monitor_batch mb
LEFT JOIN monitor_batch_item mbi ON mb.id = mbi.batch_id
GROUP BY mb.id
HAVING declared_count != actual_count;
```

### ğŸ§ª å‹æµ‹ä¸å‘Šè­¦ä¼˜åŒ–

#### 1. åˆ†åº“/åˆ†åŒºç­–ç•¥

**æ–¹æ¡ˆ**: `monitor_alert_log` å»ºè®®**æœˆåˆ†åŒº + task_id å­åˆ†åŒº**ä»¥å‡è¡¡å†™å…¥çƒ­ç‚¹ã€‚

```sql
-- åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE monitor_alert_log (
    id BIGINT AUTO_INCREMENT,
    task_id BIGINT NOT NULL,
    config_id BIGINT NULL,
    config_version INT NULL,
    ca VARCHAR(64) NULL,
    alert_type VARCHAR(50) NOT NULL,
    alert_data JSON NULL,
    notify_status TINYINT DEFAULT 0,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id, create_time, task_id),  -- å¿…é¡»åŒ…å«åˆ†åŒºé”®
    INDEX idx_task_time (task_id, create_time),
    INDEX idx_ca_time (ca, create_time)
)
PARTITION BY RANGE COLUMNS(create_time)
SUBPARTITION BY HASH(task_id)
SUBPARTITIONS 4  -- æ¯ä¸ªæ—¶é—´åˆ†åŒºå†æŒ‰ task_id åˆ†4ä¸ªå­åˆ†åŒº
(
    PARTITION p202511 VALUES LESS THAN ('2025-12-01'),
    PARTITION p202512 VALUES LESS THAN ('2026-01-01'),
    PARTITION p202601 VALUES LESS THAN ('2026-02-01'),
    PARTITION p_future VALUES LESS THAN (MAXVALUE)
);

-- è‡ªåŠ¨åˆ›å»ºä¸‹æœˆåˆ†åŒºï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
```

```python
def create_next_month_partition():
    """åˆ›å»ºä¸‹æœˆåˆ†åŒºï¼ˆæ¯æœˆ1å·å‡Œæ™¨æ‰§è¡Œï¼‰"""
    next_month = (datetime.now() + timedelta(days=32)).replace(day=1)
    next_next_month = (next_month + timedelta(days=32)).replace(day=1)
    partition_name = f"p{next_month.strftime('%Y%m')}"
    
    sql = f"""
    ALTER TABLE monitor_alert_log
    REORGANIZE PARTITION p_future INTO (
        PARTITION {partition_name} VALUES LESS THAN ('{next_next_month.strftime('%Y-%m-%d')}'),
        PARTITION p_future VALUES LESS THAN (MAXVALUE)
    )
    """
    db.execute(sql)
    logger.info(f"âœ… åˆ›å»ºåˆ†åŒº {partition_name}")
```

#### 2. å‘Šè­¦èšåˆçª—å£

**æ–¹æ¡ˆ**: å¯¹åŒ CA åœ¨ 5 åˆ†é’Ÿå†…çš„ç›¸åŒ `alert_type` åšèšåˆçª—å£ï¼ˆè®¡æ•°/æœ€å¤§è§¦å‘å€¼/é¦–æ¬¡æ—¶é—´ï¼‰ï¼Œé™ä½åˆ·å±ã€‚

```python
from collections import defaultdict
import time

class AlertAggregator:
    """å‘Šè­¦èšåˆå™¨ï¼ˆæ»‘åŠ¨çª—å£ï¼‰"""
    def __init__(self, window_seconds=300):
        self.window = window_seconds
        self.cache = defaultdict(list)  # key -> [(timestamp, data), ...]
        self.lock = threading.Lock()
    
    def add_alert(self, ca: str, alert_type: str, trigger_value: float) -> bool:
        """æ·»åŠ å‘Šè­¦ï¼ˆè¿”å›æ˜¯å¦åº”è¯¥å‘é€ï¼‰"""
        key = f"{ca}:{alert_type}"
        now = time.time()
        
        with self.lock:
            # æ¸…ç†è¿‡æœŸæ•°æ®
            self.cache[key] = [
                (ts, data) for ts, data in self.cache[key]
                if now - ts < self.window
            ]
            
            # æ·»åŠ æ–°æ•°æ®
            self.cache[key].append((now, trigger_value))
            
            # çª—å£å†…é¦–æ¬¡è§¦å‘ -> å‘é€
            if len(self.cache[key]) == 1:
                return True
            
            # çª—å£å†…åç»­è§¦å‘ -> ä¸å‘é€ï¼ˆä½†è®°å½•ï¼‰
            logger.debug(f"ğŸ“Š å‘Šè­¦èšåˆ: {key}, çª—å£å†…ç´¯è®¡ {len(self.cache[key])} æ¬¡")
            return False
    
    def get_summary(self, ca: str, alert_type: str) -> dict:
        """è·å–çª—å£å†…æ±‡æ€»ä¿¡æ¯"""
        key = f"{ca}:{alert_type}"
        with self.lock:
            if key not in self.cache or not self.cache[key]:
                return None
            
            values = [data for _, data in self.cache[key]]
            return {
                'count': len(values),
                'first_time': datetime.fromtimestamp(self.cache[key][0][0]),
                'last_time': datetime.fromtimestamp(self.cache[key][-1][0]),
                'max_value': max(values),
                'avg_value': sum(values) / len(values)
            }

# ä½¿ç”¨
aggregator = AlertAggregator(window_seconds=300)

def process_alert(ca, alert_type, trigger_value):
    should_send = aggregator.add_alert(ca, alert_type, trigger_value)
    
    if should_send:
        # å‘é€å‘Šè­¦
        send_telegram_alert(ca, alert_type, trigger_value)
    else:
        # çª—å£å†…èšåˆï¼Œä¸å‘é€
        summary = aggregator.get_summary(ca, alert_type)
        logger.info(f"ğŸ“‰ å‘Šè­¦å·²èšåˆ: {ca} {alert_type}, çª—å£å†…{summary['count']}æ¬¡")
```

### ğŸ” è´¨é‡ä¸é£æ§

#### 1. åœ°å€æ ¡éªŒ

**æ–¹æ¡ˆ**: å…¥åº“å‰åšé“¾åˆ« + æ ¡éªŒå’Œï¼ˆEIP-55 å¯é€‰ï¼Œå­˜å°å†™å³å¯ï¼‰ã€‚

```python
def validate_address(chain_type: str, address: str) -> bool:
    """éªŒè¯åŒºå—é“¾åœ°å€æ ¼å¼"""
    if chain_type in ['bsc', 'eth', 'polygon']:
        # EVM åœ°å€ï¼š0x + 40ä½åå…­è¿›åˆ¶
        if not re.match(r'^0x[a-fA-F0-9]{40}$', address):
            return False
        # å¯é€‰ï¼šéªŒè¯ EIP-55 æ ¡éªŒå’Œ
        return True
    
    elif chain_type == 'sol':
        # Solana åœ°å€ï¼šbase58, 32-44å­—ç¬¦
        if not re.match(r'^[1-9A-HJ-NP-Za-km-z]{32,44}$', address):
            return False
        return True
    
    return False

def normalize_address(chain_type: str, address: str) -> str:
    """è§„èŒƒåŒ–åœ°å€ï¼ˆEVMè½¬å°å†™ï¼‰"""
    if chain_type in ['bsc', 'eth', 'polygon']:
        return address.lower()
    return address

# ä½¿ç”¨
def add_target(task_id, chain_type, ca):
    if not validate_address(chain_type, ca):
        raise ValueError(f"æ— æ•ˆçš„ {chain_type} åœ°å€: {ca}")
    
    ca_normalized = normalize_address(chain_type, ca)
    db.execute("""
        INSERT INTO monitor_task_target (task_id, target_value, chain_type)
        VALUES (%s, %s, %s)
    """, (task_id, ca_normalized, chain_type))
```

#### 2. å¹‚ç­‰å†™ä¸é¦–æ¬¡å‘ç°æ—¶é—´

**æ–¹æ¡ˆ**: æ‰¹é‡/æ™ºèƒ½ç‰©åŒ–é‡‡ç”¨ `INSERT â€¦ ON DUPLICATE KEY UPDATE`ï¼Œå¹¶è®°å½• `first_seen_time`ï¼ˆä¾¿äºåš"æ–°ç”Ÿ token"ç­–ç•¥ï¼‰ã€‚

```sql
-- ä¿®æ”¹è¡¨ç»“æ„
ALTER TABLE monitor_task_target
ADD COLUMN first_seen_time DATETIME NULL COMMENT 'é¦–æ¬¡å‘ç°æ—¶é—´',
ADD COLUMN last_seen_time DATETIME NULL COMMENT 'æœ€åå‘ç°æ—¶é—´',
ADD UNIQUE KEY uk_task_target (task_id, target_type, target_value);
```

```python
def upsert_target(task_id: int, target_type: str, target_value: str, metadata: dict):
    """å¹‚ç­‰å†™å…¥ç›®æ ‡ï¼ˆé¦–æ¬¡/æ›´æ–°æ—¶é—´è‡ªåŠ¨ç»´æŠ¤ï¼‰"""
    db.execute("""
        INSERT INTO monitor_task_target (
            task_id, target_type, target_value, token_name, token_symbol,
            first_seen_time, last_seen_time, create_time
        )
        VALUES (%s, %s, %s, %s, %s, NOW(), NOW(), NOW())
        ON DUPLICATE KEY UPDATE
            token_name = VALUES(token_name),
            token_symbol = VALUES(token_symbol),
            last_seen_time = NOW(),
            update_time = NOW()
    """, (task_id, target_type, target_value, metadata['name'], metadata['symbol']))

# æ–°ç”Ÿ token ç­–ç•¥ï¼ˆå‘ç°æ—¶é—´ < 1å°æ—¶ï¼‰
def get_new_tokens(task_id: int, hours: int = 1):
    """è·å–æ–°ç”Ÿ tokenï¼ˆé¦–æ¬¡å‘ç°æ—¶é—´åœ¨Nå°æ—¶å†…ï¼‰"""
    return db.fetchall("""
        SELECT * FROM monitor_task_target
        WHERE task_id = %s
          AND first_seen_time > DATE_SUB(NOW(), INTERVAL %s HOUR)
        ORDER BY first_seen_time DESC
    """, (task_id, hours))
```

#### 3. RPS å®ˆé—¨äººï¼ˆå…¨å±€é™æµï¼‰

**æ–¹æ¡ˆ**: åœ¨æ‰§è¡Œå™¨å‰å…¨å±€é™æµï¼ˆRedis ä»¤ç‰Œæ¡¶ï¼‰ï¼Œä¸åŒé“¾/ä¾›åº”å•†ï¼ˆNodeReal/Chainstackï¼‰å•ç‹¬æ¡¶ï¼Œé˜²æ­¢çªå‘è¶…é™ã€‚

```python
import redis
import time

class RateLimiter:
    """Redisä»¤ç‰Œæ¡¶é™æµå™¨"""
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client
    
    def acquire(self, key: str, rate: int, capacity: int) -> bool:
        """
        å°è¯•è·å–ä»¤ç‰Œ
        :param key: é™æµé”®ï¼ˆå¦‚ 'rpc:bsc:nodereal'ï¼‰
        :param rate: æ¯ç§’å¡«å……é€Ÿç‡
        :param capacity: æ¡¶å®¹é‡
        :return: æ˜¯å¦æˆåŠŸè·å–
        """
        now = time.time()
        
        # Lua è„šæœ¬ä¿è¯åŸå­æ€§
        lua_script = """
        local key = KEYS[1]
        local rate = tonumber(ARGV[1])
        local capacity = tonumber(ARGV[2])
        local now = tonumber(ARGV[3])
        local requested = tonumber(ARGV[4])
        
        local bucket = redis.call('HMGET', key, 'tokens', 'last_time')
        local tokens = tonumber(bucket[1]) or capacity
        local last_time = tonumber(bucket[2]) or now
        
        -- è®¡ç®—æ–°å¢ä»¤ç‰Œ
        local delta = math.max(0, now - last_time)
        tokens = math.min(capacity, tokens + delta * rate)
        
        if tokens >= requested then
            tokens = tokens - requested
            redis.call('HMSET', key, 'tokens', tokens, 'last_time', now)
            redis.call('EXPIRE', key, 10)
            return 1
        else
            redis.call('HMSET', key, 'tokens', tokens, 'last_time', now)
            redis.call('EXPIRE', key, 10)
            return 0
        end
        """
        
        result = self.redis.eval(
            lua_script,
            1,
            key,
            rate,
            capacity,
            now,
            1  # æ¯æ¬¡è¯·æ±‚1ä¸ªä»¤ç‰Œ
        )
        
        return result == 1

# é…ç½®
RPC_LIMITS = {
    'bsc:nodereal': {'rate': 50, 'capacity': 100},     # 50 RPS
    'bsc:chainstack': {'rate': 30, 'capacity': 60},    # 30 RPS
    'sol:helius': {'rate': 100, 'capacity': 200},      # 100 RPS
}

# ä½¿ç”¨
redis_client = redis.Redis(host='localhost', port=6379)
limiter = RateLimiter(redis_client)

def call_rpc(chain: str, provider: str, method: str, params: list):
    """è°ƒç”¨RPCï¼ˆå¸¦é™æµä¿æŠ¤ï¼‰"""
    key = f"rpc:{chain}:{provider}"
    limits = RPC_LIMITS[key]
    
    # å°è¯•è·å–ä»¤ç‰Œ
    if not limiter.acquire(key, limits['rate'], limits['capacity']):
        logger.warning(f"ğŸš¦ RPCé™æµè§¦å‘: {key}")
        time.sleep(0.1)  # çŸ­æš‚ç­‰å¾…
        if not limiter.acquire(key, limits['rate'], limits['capacity']):
            raise Exception(f"RPCé™æµè¶…é™: {key}")
    
    # æ‰§è¡Œå®é™…è°ƒç”¨
    return rpc_client.call(method, params)
```

### ğŸ“ˆ ç›‘æ§æŒ‡æ ‡å¢å¼º

**æ–°å¢æŒ‡æ ‡**:

```python
# Prometheus æŒ‡æ ‡å®šä¹‰
from prometheus_client import Counter, Histogram, Gauge

# RPS é™æµæŒ‡æ ‡
rpc_rate_limit_total = Counter(
    'monitor_rpc_rate_limit_total',
    'RPCé™æµè§¦å‘æ¬¡æ•°',
    ['chain', 'provider']
)

# å‘Šè­¦èšåˆæŒ‡æ ‡
alert_aggregated_total = Counter(
    'monitor_alert_aggregated_total',
    'è¢«èšåˆçš„å‘Šè­¦æ•°é‡',
    ['ca', 'alert_type']
)

# å­¤å„¿æ‰¹æ¬¡æŒ‡æ ‡
orphan_batch_recovered_total = Counter(
    'monitor_orphan_batch_recovered_total',
    'å­¤å„¿æ‰¹æ¬¡å›æ”¶æ¬¡æ•°',
    ['task_id']
)

# é…ç½®å˜æ›´å»æŠ–æŒ‡æ ‡
config_debounce_total = Counter(
    'monitor_config_debounce_total',
    'é…ç½®å˜æ›´å»æŠ–æ¬¡æ•°',
    ['task_id']
)

# åœ°å€æ ¡éªŒå¤±è´¥æŒ‡æ ‡
address_validation_failed_total = Counter(
    'monitor_address_validation_failed_total',
    'åœ°å€æ ¡éªŒå¤±è´¥æ¬¡æ•°',
    ['chain_type']
)
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

1. [MySQLå¤§è¡¨åœ¨çº¿è¿ç§»æ–¹æ¡ˆ](https://dev.mysql.com/doc/)
2. [é›¶åœæœºæ•°æ®åº“è¿ç§»æœ€ä½³å®è·µ](https://martinfowler.com/articles/zero-downtime-migrations.html)
3. [æ•°æ®åº“é‡æ„æ¨¡å¼](https://www.refactoring-databases.com/)
4. [MySQL 8.0 åˆ†åŒºè¡¨æœ€ä½³å®è·µ](https://dev.mysql.com/doc/refman/8.0/en/partitioning.html)
5. [Redis é™æµç®—æ³•](https://redis.io/docs/reference/patterns/rate-limiting/)
6. [ä¸€è‡´æ€§å“ˆå¸ŒåŸç†](https://en.wikipedia.org/wiki/Consistent_hashing)

---

## ğŸ“ è”ç³»æ–¹å¼

- **æŠ€æœ¯è´Ÿè´£äºº**: [ä½ çš„åå­—]
- **é¡¹ç›®ç»ç†**: [PMåå­—]
- **ç´§æ€¥è”ç³»**: [ç”µè¯/é‚®ç®±]

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆè®¾è®¡ï¼Œå¾…å†³ç­–æ˜¯å¦å®æ–½

**å†³ç­–å»ºè®®**: 
- âœ… **å»ºè®®å®æ–½** - é•¿æœŸæ”¶ç›Šå¤§äºçŸ­æœŸæˆæœ¬
- â° **æœ€ä½³æ—¶æœº** - ç”¨æˆ·æ´»è·ƒåº¦è¾ƒä½çš„æ—¶æ®µï¼ˆå¦‚å‘¨æœ«ï¼‰
- ğŸ›¡ï¸ **é£é™©å¯æ§** - æœ‰å®Œæ•´çš„å›æ»šæ–¹æ¡ˆ

**æœ€ç»ˆå†³ç­–**: [âœ…] æ‰¹å‡†å®æ–½ / [ ] æš‚ç¼“å®æ–½ / [ ] æ‹’ç»å®æ–½

---

## ğŸ¨ å‰ç«¯é¡µé¢æ¶æ„è®¾è®¡

> **è®¾è®¡åŸåˆ™**: é¦–é¡µå¿«æ·æ“ä½œ + ç‹¬ç«‹é¡µé¢å®Œæ•´ç®¡ç†  
> **è®¾è®¡æ—¶é—´**: 2025-11-10  
> **å®æ–½çŠ¶æ€**: é¦–é¡µå·²å®Œæˆï¼Œç‹¬ç«‹é¡µé¢å¾…å¼€å‘

### ğŸ“‹ é¡µé¢ç»“æ„

#### èœå•æ ‘ç»“æ„

```
ç›‘æ§V2 (crypto:monitor-v2)
â”œâ”€â”€ ğŸ“Š ç›‘æ§æ€»è§ˆ (crypto:monitor-v2:view)
â”‚   è·¯ç”±: /monitor-v2/dashboard
â”‚   ç»„ä»¶: views/monitor-v2/dashboard/index.vue
â”‚   è¯´æ˜: é¦–é¡µçœ‹æ¿ï¼ŒåŒ…å«3ä¸ªå¿«æ·å¡ç‰‡ + å¯è§†åŒ–å›¾è¡¨
â”‚
â”œâ”€â”€ âš™ï¸ é…ç½®ç®¡ç† (crypto:monitor-v2:config)
â”‚   è·¯ç”±: /monitor-v2/config
â”‚   ç»„ä»¶: views/monitor-v2/config/index.vue
â”‚   è¯´æ˜: å®Œæ•´çš„é…ç½®ç®¡ç†é¡µé¢ï¼ˆåˆ—è¡¨ã€æ–°å¢ã€ç¼–è¾‘ã€è¯¦æƒ…ï¼‰
â”‚   æƒé™æŒ‰é’®:
â”‚     - æŸ¥è¯¢ (crypto:monitor-v2:config:list)
â”‚     - æ–°å¢ (crypto:monitor-v2:config:add)
â”‚     - ä¿®æ”¹ (crypto:monitor-v2:config:edit)
â”‚     - åˆ é™¤ (crypto:monitor-v2:config:remove)
â”‚     - è¯¦æƒ… (crypto:monitor-v2:config:query)
â”‚
â”œâ”€â”€ ğŸ“ ä»»åŠ¡ç®¡ç† (crypto:monitor-v2:task)
â”‚   è·¯ç”±: /monitor-v2/task
â”‚   ç»„ä»¶: views/monitor-v2/task/index.vue
â”‚   è¯´æ˜: å®Œæ•´çš„ä»»åŠ¡ç®¡ç†é¡µé¢ï¼ˆ3ç§ç±»å‹ä»»åŠ¡ï¼‰
â”‚   æƒé™æŒ‰é’®:
â”‚     - æŸ¥è¯¢ (crypto:monitor-v2:task:list)
â”‚     - æ–°å¢ (crypto:monitor-v2:task:add)
â”‚     - ä¿®æ”¹ (crypto:monitor-v2:task:edit)
â”‚     - åˆ é™¤ (crypto:monitor-v2:task:remove)
â”‚     - è¯¦æƒ… (crypto:monitor-v2:task:query)
â”‚     - å¯åŠ¨ (crypto:monitor-v2:task:start)
â”‚     - åœæ­¢ (crypto:monitor-v2:task:stop)
â”‚
â”œâ”€â”€ âš¡ æ‰¹æ¬¡ç®¡ç† (crypto:monitor-v2:batch)
â”‚   è·¯ç”±: /monitor-v2/batch
â”‚   ç»„ä»¶: views/monitor-v2/batch/index.vue
â”‚   è¯´æ˜: å®Œæ•´çš„æ‰¹æ¬¡ç®¡ç†é¡µé¢ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€ç›‘æ§ï¼‰
â”‚   æƒé™æŒ‰é’®:
â”‚     - æŸ¥è¯¢ (crypto:monitor-v2:batch:list)
â”‚     - è¯¦æƒ… (crypto:monitor-v2:batch:query)
â”‚     - é‡å¯ (crypto:monitor-v2:batch:restart)
â”‚
â””â”€â”€ ğŸ”” å‘Šè­¦æ—¥å¿— (crypto:monitor-v2:alert)
    è·¯ç”±: /monitor-v2/alert
    ç»„ä»¶: views/monitor-v2/alert/index.vue
    è¯´æ˜: å®Œæ•´çš„å‘Šè­¦ç®¡ç†é¡µé¢ï¼ˆåˆ—è¡¨ã€å¤„ç†ã€ç»Ÿè®¡ï¼‰
    æƒé™æŒ‰é’®:
      - æŸ¥è¯¢ (crypto:monitor-v2:alert:list)
      - è¯¦æƒ… (crypto:monitor-v2:alert:query)
      - å¤„ç† (crypto:monitor-v2:alert:handle)
```

---

### ğŸ“Š ç›‘æ§æ€»è§ˆï¼ˆDashboardï¼‰- é¦–é¡µ

**æ–‡ä»¶è·¯å¾„**: `views/monitor-v2/dashboard/index.vue`  
**å½“å‰çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆå¯¹åº”ç°æœ‰çš„ `views/index.vue`ï¼‰

**é¡µé¢å¸ƒå±€:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›‘æ§æ€»è§ˆ / æ§åˆ¶å°                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ“ˆ æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡åŒºï¼ˆå¿«æ·æ“ä½œï¼‰                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚é…ç½®ç®¡ç†  â”‚  â”‚ä»»åŠ¡ç®¡ç†  â”‚  â”‚æ‰¹æ¬¡æ‰§è¡Œ  â”‚                  â”‚
â”‚  â”‚- ç»Ÿè®¡    â”‚  â”‚- ç»Ÿè®¡    â”‚  â”‚- ç»Ÿè®¡    â”‚                  â”‚
â”‚  â”‚- æ–°å»º    â”‚  â”‚- æ–°å»º    â”‚  â”‚- åˆ—è¡¨    â”‚                  â”‚
â”‚  â”‚- ç®¡ç†    â”‚  â”‚- åˆ—è¡¨    â”‚  â”‚- ç›‘æ§    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š å¯è§†åŒ–å›¾è¡¨åŒºï¼ˆå¾…å¼€å‘ï¼‰                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  é…ç½®-ä»»åŠ¡-æ‰¹æ¬¡å…³ç³»å›¾ï¼ˆSankey æ¡‘åŸºå›¾ï¼‰                  â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚  é…ç½®A â”€â”€â”                                               â”‚â”‚
â”‚  â”‚         â”œâ”€â”€â†’ ä»»åŠ¡1 â”€â”€â†’ æ‰¹æ¬¡001ï¼ˆè¿è¡Œä¸­ï¼Œ10é¡¹ï¼‰         â”‚â”‚
â”‚  â”‚  é…ç½®B â”€â”€â”¤                                               â”‚â”‚
â”‚  â”‚         â””â”€â”€â†’ ä»»åŠ¡2 â”€â”€â†’ æ‰¹æ¬¡002ï¼ˆæš‚åœï¼Œ15é¡¹ï¼‰           â”‚â”‚
â”‚  â”‚  é…ç½®C â”€â”€â”€â”€â”€â”€â†’ ä»»åŠ¡3 â”€â”€â†’ æ‰¹æ¬¡003ï¼ˆå¿ƒè·³è¶…æ—¶ï¼Œ8é¡¹ï¼‰      â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ æ‰¹æ¬¡è¿è¡ŒçŠ¶æ€åˆ†å¸ƒ  â”‚  â”‚ ä»»åŠ¡ç±»å‹åˆ†å¸ƒ      â”‚              â”‚
â”‚  â”‚ ï¼ˆé¥¼å›¾ï¼‰          â”‚  â”‚ ï¼ˆæŸ±çŠ¶å›¾ï¼‰        â”‚              â”‚
â”‚  â”‚ - è¿è¡Œä¸­: 10      â”‚  â”‚ - æ™ºèƒ½ç›‘æ§: 12    â”‚              â”‚
â”‚  â”‚ - æš‚åœ: 5         â”‚  â”‚ - æ‰¹é‡ç›‘æ§: 8     â”‚              â”‚
â”‚  â”‚ - å¿ƒè·³è¶…æ—¶: 2     â”‚  â”‚ - åŒºå—ç›‘æ§: 5     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                              â”‚
â”‚  ğŸ“‹ å®æ—¶åŠ¨æ€åŒºï¼ˆå¾…å¼€å‘ï¼‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æœ€è¿‘å‘Šè­¦ï¼ˆTop 10ï¼‰                                      â”‚â”‚
â”‚  â”‚ - Token XXX ä»·æ ¼ä¸Šæ¶¨ 25%  [5åˆ†é’Ÿå‰]   [æŸ¥çœ‹è¯¦æƒ…]      â”‚â”‚
â”‚  â”‚ - Token YYY å¿ƒè·³è¶…æ—¶      [10åˆ†é’Ÿå‰]  [æŸ¥çœ‹è¯¦æƒ…]      â”‚â”‚
â”‚  â”‚ ...                                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ æœ€è¿‘ä»»åŠ¡å˜æ›´     â”‚  â”‚ æ‰¹æ¬¡å®Œæˆè¶‹åŠ¿     â”‚                â”‚
â”‚  â”‚ ï¼ˆæ—¶é—´çº¿ï¼‰       â”‚  â”‚ ï¼ˆæŠ˜çº¿å›¾ï¼‰       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½:**
- âœ… 3ä¸ªå¿«æ·å¡ç‰‡ï¼ˆConfigCardã€TaskCardã€BatchCardï¼‰
- â³ é…ç½®-ä»»åŠ¡-æ‰¹æ¬¡å…³ç³»å¯è§†åŒ–ï¼ˆSankeyå›¾ï¼‰
- â³ æ‰¹æ¬¡çŠ¶æ€åˆ†å¸ƒå›¾ï¼ˆé¥¼å›¾ï¼‰
- â³ ä»»åŠ¡ç±»å‹åˆ†å¸ƒå›¾ï¼ˆæŸ±çŠ¶å›¾ï¼‰
- â³ æœ€è¿‘å‘Šè­¦åˆ—è¡¨ï¼ˆTop 10ï¼‰
- â³ ä»»åŠ¡å˜æ›´æ—¶é—´çº¿
- â³ æ‰¹æ¬¡å®Œæˆè¶‹åŠ¿ï¼ˆæŠ˜çº¿å›¾ï¼‰

**æŠ€æœ¯æ ˆ:**
- EChartsï¼ˆå›¾è¡¨æ¸²æŸ“ï¼‰
- Element Plusï¼ˆUIç»„ä»¶ï¼‰
- å®æ—¶æ•°æ®é€šè¿‡ WebSocket æ¨é€

---

### âš™ï¸ é…ç½®ç®¡ç†ï¼ˆå®Œæ•´é¡µé¢ï¼‰

**æ–‡ä»¶è·¯å¾„**: `views/monitor-v2/config/index.vue`  
**å½“å‰çŠ¶æ€**: â³ å¾…å¼€å‘

**é¡µé¢åŠŸèƒ½:**
1. **é…ç½®åˆ—è¡¨**
   - è¡¨æ ¼å±•ç¤ºï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
   - å­—æ®µï¼šé…ç½®åç§°ã€ç±»å‹ã€é“¾ç±»å‹ã€çŠ¶æ€ã€å…³è”ä»»åŠ¡æ•°ã€åˆ›å»ºæ—¶é—´
   - ç­›é€‰æ¡ä»¶ï¼šé…ç½®ç±»å‹ã€é“¾ç±»å‹ã€çŠ¶æ€ï¼ˆå¯ç”¨/åœç”¨ï¼‰
   
2. **é…ç½®æ–°å¢**
   - è¡¨å•å¯¹è¯æ¡†/æŠ½å±‰
   - æ”¯æŒä»·æ ¼ã€æŒä»“ã€äº¤æ˜“é‡ç­‰ç›‘æ§è§„åˆ™
   - åŠ¨æ€é…ç½® `eventsConfig` å­—æ®µ

3. **é…ç½®ç¼–è¾‘**
   - ç¼–è¾‘å·²æœ‰é…ç½®
   - ç‰ˆæœ¬æ§åˆ¶ï¼ˆè®°å½•ä¿®æ”¹å†å²ï¼‰

4. **é…ç½®è¯¦æƒ…**
   - æŸ¥çœ‹å®Œæ•´é…ç½®ä¿¡æ¯
   - æŸ¥çœ‹å…³è”çš„ä»»åŠ¡åˆ—è¡¨
   - æŸ¥çœ‹é…ç½®ä½¿ç”¨ç»Ÿè®¡

5. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡åˆ é™¤
   - æ‰¹é‡å¯ç”¨/åœç”¨

6. **å…¶ä»–åŠŸèƒ½**
   - é…ç½®å¤åˆ¶ï¼ˆå¿«é€Ÿåˆ›å»ºç›¸ä¼¼é…ç½®ï¼‰
   - é…ç½®é¢„è§ˆï¼ˆæŸ¥çœ‹ç›‘æ§æ¡ä»¶ï¼‰

---

### ğŸ“ ä»»åŠ¡ç®¡ç†ï¼ˆå®Œæ•´é¡µé¢ï¼‰

**æ–‡ä»¶è·¯å¾„**: `views/monitor-v2/task/index.vue`  
**å½“å‰çŠ¶æ€**: â³ å¾…å¼€å‘

**é¡µé¢åŠŸèƒ½:**
1. **ä»»åŠ¡åˆ—è¡¨**
   - è¡¨æ ¼å±•ç¤ºï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
   - å­—æ®µï¼šä»»åŠ¡åç§°ã€ç±»å‹ã€é…ç½®ã€çŠ¶æ€ã€è¿è¡Œæ‰¹æ¬¡æ•°ã€åˆ›å»ºæ—¶é—´
   - ç­›é€‰æ¡ä»¶ï¼šä»»åŠ¡ç±»å‹ã€é“¾ç±»å‹ã€çŠ¶æ€ï¼ˆè¿è¡Œ/åœæ­¢ï¼‰

2. **ä»»åŠ¡æ–°å¢**
   - æ”¯æŒ3ç§ä»»åŠ¡ç±»å‹ï¼š
     - æ™ºèƒ½ç›‘æ§ï¼ˆå¸‚å€¼èŒƒå›´ã€Twitterè¦æ±‚ã€è‡ªåŠ¨åŒæ­¥ï¼‰
     - æ‰¹é‡ç›‘æ§ï¼ˆæ‰‹åŠ¨è¾“å…¥CAåˆ—è¡¨ï¼‰
     - åŒºå—ç›‘æ§ï¼ˆå…¨é“¾ç›‘å¬ï¼‰
   - å…³è”é…ç½®ï¼ˆå•é€‰ï¼‰

3. **ä»»åŠ¡ç¼–è¾‘**
   - ä¿®æ”¹ä»»åŠ¡åŸºæœ¬ä¿¡æ¯
   - ä¿®æ”¹ç›®æ ‡åˆ—è¡¨ï¼ˆæ‰¹é‡ç›‘æ§ï¼‰

4. **ä»»åŠ¡è¯¦æƒ…**
   - æŸ¥çœ‹ä»»åŠ¡å®Œæ•´ä¿¡æ¯
   - æŸ¥çœ‹å…³è”çš„é…ç½®è¯¦æƒ…
   - æŸ¥çœ‹ç›®æ ‡åˆ—è¡¨ï¼ˆæ™ºèƒ½ç›‘æ§/æ‰¹é‡ç›‘æ§ï¼‰
   - æŸ¥çœ‹æ‰§è¡Œæ‰¹æ¬¡åˆ—è¡¨
   - æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—

5. **ä»»åŠ¡æ§åˆ¶**
   - å¯åŠ¨ä»»åŠ¡
   - åœæ­¢ä»»åŠ¡
   - é‡å¯ä»»åŠ¡

6. **ç›®æ ‡ç®¡ç†**ï¼ˆæ™ºèƒ½ç›‘æ§ï¼‰
   - æŸ¥çœ‹å½“å‰åŒæ­¥çš„ç›®æ ‡åˆ—è¡¨
   - æ‰‹åŠ¨åˆ·æ–°ç›®æ ‡
   - æŸ¥çœ‹ç›®æ ‡åŒæ­¥æ—¥å¿—

---

### âš¡ æ‰¹æ¬¡ç®¡ç†ï¼ˆå®Œæ•´é¡µé¢ï¼‰

**æ–‡ä»¶è·¯å¾„**: `views/monitor-v2/batch/index.vue`  
**å½“å‰çŠ¶æ€**: â³ å¾…å¼€å‘

**é¡µé¢åŠŸèƒ½:**
1. **æ‰¹æ¬¡åˆ—è¡¨**
   - è¡¨æ ¼å±•ç¤ºï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
   - å­—æ®µï¼šæ‰¹æ¬¡å·ã€ä»»åŠ¡ã€Workerã€çŠ¶æ€ã€é¡¹æ•°ã€å‘Šè­¦æ•°ã€é”™è¯¯æ•°ã€å¿ƒè·³æ—¶é—´
   - ç­›é€‰æ¡ä»¶ï¼šä»»åŠ¡ã€çŠ¶æ€ã€Worker

2. **æ‰¹æ¬¡è¯¦æƒ…**
   - æŸ¥çœ‹æ‰¹æ¬¡å®Œæ•´ä¿¡æ¯
   - æŸ¥çœ‹æ‰¹æ¬¡é¡¹åˆ—è¡¨ï¼ˆâ‰¤99é¡¹ï¼‰
   - æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—

3. **æ‰¹æ¬¡ç›‘æ§**
   - å®æ—¶å¿ƒè·³ç›‘æ§
   - æ‰¹æ¬¡æ‰§è¡Œè¿›åº¦
   - æ€§èƒ½æŒ‡æ ‡ï¼ˆå¤„ç†é€Ÿåº¦ã€æˆåŠŸç‡ï¼‰

4. **æ‰¹æ¬¡æ§åˆ¶**
   - é‡å¯æ‰¹æ¬¡
   - æš‚åœæ‰¹æ¬¡
   - ç»ˆæ­¢æ‰¹æ¬¡

5. **æ‰¹æ¬¡åˆ†æ**
   - æ‰¹æ¬¡æ‰§è¡Œå†å²
   - æ‰¹æ¬¡æ€§èƒ½åˆ†æ
   - Workerè´Ÿè½½åˆ†æ

---

### ğŸ”” å‘Šè­¦æ—¥å¿—ï¼ˆå®Œæ•´é¡µé¢ï¼‰

**æ–‡ä»¶è·¯å¾„**: `views/monitor-v2/alert/index.vue`  
**å½“å‰çŠ¶æ€**: â³ å¾…å¼€å‘ï¼ˆPhase 3ï¼‰

**é¡µé¢åŠŸèƒ½:**
1. **å‘Šè­¦åˆ—è¡¨**
   - è¡¨æ ¼å±•ç¤ºï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
   - å­—æ®µï¼šTokenã€å‘Šè­¦ç±»å‹ã€è§¦å‘æ¡ä»¶ã€æ—¶é—´ã€çŠ¶æ€ã€å¤„ç†äºº
   - ç­›é€‰æ¡ä»¶ï¼šå‘Šè­¦ç±»å‹ã€çŠ¶æ€ã€æ—¶é—´èŒƒå›´

2. **å‘Šè­¦è¯¦æƒ…**
   - æŸ¥çœ‹å‘Šè­¦å®Œæ•´ä¿¡æ¯
   - æŸ¥çœ‹è§¦å‘åŸå› 
   - æŸ¥çœ‹å…³è”çš„é…ç½®/ä»»åŠ¡

3. **å‘Šè­¦å¤„ç†**
   - æ ‡è®°å·²è¯»
   - æ ‡è®°å·²å¤„ç†
   - æ·»åŠ å¤„ç†å¤‡æ³¨

4. **å‘Šè­¦ç»Ÿè®¡**
   - æŒ‰æ—¶é—´ç»Ÿè®¡
   - æŒ‰ç±»å‹ç»Ÿè®¡
   - æŒ‰Tokenç»Ÿè®¡

5. **å‘Šè­¦è§„åˆ™åˆ†æ**
   - é¢‘ç¹è§¦å‘çš„è§„åˆ™
   - è§„åˆ™æœ‰æ•ˆæ€§åˆ†æ

---

### ğŸ“Š å¯è§†åŒ–å›¾è¡¨è®¾è®¡

#### 1. é…ç½®-ä»»åŠ¡-æ‰¹æ¬¡å…³ç³»å›¾ï¼ˆSankeyå›¾ï¼‰

**æ•°æ®æ¥æº:**
```javascript
// API: GET /crypto/monitor-v2/dashboard/relation
{
  nodes: [
    { name: 'é…ç½®Aï¼šä»·æ ¼ç›‘æ§' },
    { name: 'ä»»åŠ¡1ï¼šæ™ºèƒ½ç›‘æ§' },
    { name: 'æ‰¹æ¬¡001' }
  ],
  links: [
    { source: 'é…ç½®Aï¼šä»·æ ¼ç›‘æ§', target: 'ä»»åŠ¡1ï¼šæ™ºèƒ½ç›‘æ§', value: 1 },
    { source: 'ä»»åŠ¡1ï¼šæ™ºèƒ½ç›‘æ§', target: 'æ‰¹æ¬¡001', value: 10 }
  ]
}
```

**EChartsé…ç½®:**
```javascript
{
  series: [{
    type: 'sankey',
    layout: 'none',
    emphasis: { focus: 'adjacency' },
    data: nodes,
    links: links
  }]
}
```

#### 2. æ‰¹æ¬¡çŠ¶æ€åˆ†å¸ƒå›¾ï¼ˆé¥¼å›¾ï¼‰

**æ•°æ®æ¥æº:**
```javascript
// API: GET /crypto/monitor-v2/batch/stats
{
  running: 10,
  paused: 5,
  heartbeatTimeout: 2,
  completed: 3
}
```

**EChartsé…ç½®:**
```javascript
{
  series: [{
    type: 'pie',
    radius: ['40%', '70%'],
    data: [
      { value: 10, name: 'è¿è¡Œä¸­', itemStyle: { color: '#67C23A' } },
      { value: 5, name: 'æš‚åœ', itemStyle: { color: '#E6A23C' } },
      { value: 2, name: 'å¿ƒè·³è¶…æ—¶', itemStyle: { color: '#F56C6C' } }
    ]
  }]
}
```

#### 3. ä»»åŠ¡ç±»å‹åˆ†å¸ƒå›¾ï¼ˆæŸ±çŠ¶å›¾ï¼‰

**æ•°æ®æ¥æº:**
```javascript
// API: GET /crypto/monitor-v2/task/stats
{
  smart: 12,
  batch: 8,
  block: 5
}
```

**EChartsé…ç½®:**
```javascript
{
  xAxis: { type: 'category', data: ['æ™ºèƒ½ç›‘æ§', 'æ‰¹é‡ç›‘æ§', 'åŒºå—ç›‘æ§'] },
  yAxis: { type: 'value' },
  series: [{
    type: 'bar',
    data: [12, 8, 5],
    itemStyle: { color: '#409EFF' }
  }]
}
```

---

### ğŸ¯ å¼€å‘ä¼˜å…ˆçº§

#### é˜¶æ®µ1ï¼šé¦–é¡µä¼˜åŒ–ï¼ˆæœ¬å‘¨ï¼‰
- âœ… 3ä¸ªå¿«æ·å¡ç‰‡ï¼ˆå·²å®Œæˆï¼‰
- â³ é…ç½®-ä»»åŠ¡-æ‰¹æ¬¡å…³ç³»å›¾
- â³ æ‰¹æ¬¡çŠ¶æ€åˆ†å¸ƒå›¾
- â³ ä»»åŠ¡ç±»å‹åˆ†å¸ƒå›¾

#### é˜¶æ®µ2ï¼šç‹¬ç«‹é¡µé¢å¼€å‘ï¼ˆä¸‹å‘¨ï¼‰
- â³ é…ç½®ç®¡ç†å®Œæ•´é¡µé¢
- â³ ä»»åŠ¡ç®¡ç†å®Œæ•´é¡µé¢
- â³ æ‰¹æ¬¡ç®¡ç†å®Œæ•´é¡µé¢

#### é˜¶æ®µ3ï¼šå‘Šè­¦ç³»ç»Ÿï¼ˆä¸‹ä¸‹å‘¨ï¼‰
- â³ å‘Šè­¦æ—¥å¿—é¡µé¢
- â³ å‘Šè­¦ç»Ÿè®¡å›¾è¡¨
- â³ å‘Šè­¦å®æ—¶æ¨é€

---

## ğŸ“ˆ å¼€å‘è¿›åº¦æ€»ç»“

> **å½“å‰è¿›åº¦**: 80% âœ…  
> **çŠ¶æ€**: æ¶æ„å®Œæˆã€å‰ç«¯é¦–é¡µå®Œæˆã€åç«¯APIå®Œæˆã€æ‰¹æ¬¡ç®¡ç†APIå·²å®Œæˆ  
> **æœ€åæ›´æ–°**: 2025-11-10

### âœ… å·²å®Œæˆå·¥ä½œ

#### 1. **æ•°æ®åº“è¡¨ç»“æ„ï¼ˆ100%ï¼‰**

å·²åˆ›å»ºæ‰€æœ‰7å¼ æ ¸å¿ƒè¡¨ï¼Œå­—æ®µæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ï¼š

| è¡¨å | è¯´æ˜ | å®é™…è¡¨å | çŠ¶æ€ |
|------|------|----------|------|
| é…ç½®è¡¨ | ç›‘æ§é…ç½®ï¼ˆå«ç‰ˆæœ¬æ§åˆ¶ï¼‰ | `monitor_config_v2` | âœ… |
| ä»»åŠ¡è¡¨ | ç›‘æ§ä»»åŠ¡ï¼ˆsmart/batch/blockï¼‰ | `monitor_task_v2` | âœ… |
| ä»»åŠ¡é…ç½®å…³è”è¡¨ | M:Nå…³è” | `monitor_task_config_v2` | âœ… |
| ä»»åŠ¡ç›®æ ‡è¡¨ | ç›‘æ§ç›®æ ‡ï¼ˆCA/Pairï¼‰ | `monitor_task_target_v2` | âœ… |
| æ‰¹æ¬¡å¤´è¡¨ | æ‰¹æ¬¡æ‰§è¡ŒçŠ¶æ€ | `monitor_batch_v2` | âœ… |
| æ‰¹æ¬¡é¡¹è¡¨ | æ‰¹æ¬¡æ˜ç»†ï¼ˆâ‰¤99é¡¹ï¼‰ | `monitor_batch_item_v2` | âœ… |
| å‘Šè­¦æ—¥å¿—è¡¨ | å‘Šè­¦è®°å½•ï¼ˆå»é‡ï¼‰ | `monitor_alert_log_v2` | âœ… |

**å…³é”®è°ƒæ•´ï¼š**
- âœ… `monitor_config_v2`: å­—æ®µå `config_type` â†’ `config_category`ï¼Œæ–°å¢ `source` å­—æ®µ
- âœ… `monitor_task_v2`: ç§»é™¤åŒºå—ç›‘æ§ä¸“ç”¨å­—æ®µï¼ˆ`market_type`/`minTransactionUsd`ç­‰ï¼‰ï¼Œç”±é…ç½®å±‚è´Ÿè´£
- âœ… æ‰€æœ‰è¡¨åç»Ÿä¸€ä½¿ç”¨ `_v2` åç¼€ï¼Œé¿å…ä¸æ—§ç³»ç»Ÿå†²çª

#### 2. **åç«¯APIï¼ˆ100%ï¼‰**

##### å·²å®Œæˆæ¨¡å—

| æ¨¡å— | Controller | Service | Mapper | çŠ¶æ€ |
|------|-----------|---------|--------|------|
| **é…ç½®ç®¡ç†** | `MonitorConfigController` | `MonitorConfigServiceImpl` | `MonitorConfigMapper.xml` | âœ… |
| **ä»»åŠ¡ç®¡ç†** | `MonitorTaskController` | `MonitorTaskServiceImpl` | `MonitorTaskMapper.xml` | âœ… |
| **ä»»åŠ¡é…ç½®å…³è”** | - | - | `MonitorTaskConfigMapper.xml` | âœ… |
| **ä»»åŠ¡ç›®æ ‡ç®¡ç†** | - | - | `MonitorTaskTargetMapper.xml` | âœ… |

##### APIç«¯ç‚¹æ¸…å•

**é…ç½®ç®¡ç† (`/crypto/monitor-v2/config`)**
```java
GET    /list                    // æŸ¥è¯¢é…ç½®åˆ—è¡¨
GET    /{id}                    // è·å–é…ç½®è¯¦æƒ… @PreAuthorize
POST   /                        // æ–°å¢é…ç½®
PUT    /                        // ä¿®æ”¹é…ç½® @PreAuthorize
DELETE /{ids}                   // åˆ é™¤é…ç½® @PreAuthorize
PUT    /{id}/status             // å¯ç”¨/åœç”¨é…ç½®
GET    /stats                   // é…ç½®ç»Ÿè®¡
```

**ä»»åŠ¡ç®¡ç† (`/crypto/monitor-v2/task`)**
```java
GET    /list                    // æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨
GET    /{id}                    // è·å–ä»»åŠ¡è¯¦æƒ… @PreAuthorize
POST   /smart                   // æ–°å¢æ™ºèƒ½ç›‘æ§ä»»åŠ¡
POST   /batch                   // æ–°å¢æ‰¹é‡ç›‘æ§ä»»åŠ¡
POST   /block                   // æ–°å¢åŒºå—ç›‘æ§ä»»åŠ¡
PUT    /                        // ä¿®æ”¹ä»»åŠ¡ @PreAuthorize
DELETE /{ids}                   // åˆ é™¤ä»»åŠ¡ @PreAuthorize
PUT    /{id}/start              // å¯åŠ¨ä»»åŠ¡
PUT    /{id}/stop               // åœæ­¢ä»»åŠ¡
GET    /stats                   // ä»»åŠ¡ç»Ÿè®¡
```

**æƒé™æ³¨è§£å·²æ·»åŠ ï¼š**
- âœ… `@PreAuthorize("@ss.hasPermi('crypto:monitor-v2:config:query')")` - é…ç½®è¯¦æƒ…/ç¼–è¾‘/åˆ é™¤
- âœ… `@PreAuthorize("@ss.hasPermi('crypto:monitor-v2:task:query')")` - ä»»åŠ¡è¯¦æƒ…/ç¼–è¾‘/åˆ é™¤

#### 3. **å‰ç«¯ç»„ä»¶ï¼ˆ100%ï¼‰**

##### é¦–é¡µå¡ç‰‡ç³»ç»Ÿ

| ç»„ä»¶ | æ–‡ä»¶ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| **ä¸»é¡µ** | `views/index.vue` | ç›‘æ§ç³»ç»Ÿ V2.0 é¦–é¡µ | âœ… |
| **é…ç½®å¡ç‰‡** | `components/monitor/ConfigCard.vue` | é…ç½®ç®¡ç†ï¼ˆæ–°å»º/ç¼–è¾‘/åˆ—è¡¨ï¼‰ | âœ… |
| **ä»»åŠ¡å¡ç‰‡** | `components/monitor/TaskCard.vue` | ä»»åŠ¡ç®¡ç†ï¼ˆæ–°å»º/è¯¦æƒ…/åˆ—è¡¨ï¼‰ | âœ… |
| **æ‰¹æ¬¡å¡ç‰‡** | `components/monitor/BatchCard.vue` | æ‰¹æ¬¡çŠ¶æ€ç›‘æ§ | âœ… |

##### æ ¸å¿ƒåŠŸèƒ½å®ç°

**ConfigCardï¼ˆé…ç½®å¡ç‰‡ï¼‰ï¼š**
- âœ… å¼¹çª—å¼æ–°å»º/ç¼–è¾‘é…ç½®ï¼ˆæ— éœ€é¡µé¢è·³è½¬ï¼‰
- âœ… æ”¯æŒä»·æ ¼ã€æŒä»“ã€äº¤æ˜“é‡ç›‘æ§è§„åˆ™ï¼ˆåŸºäºåŸå¡ç‰‡è®¾è®¡ï¼‰
- âœ… åŠ¨æ€æ˜¾ç¤º `eventsConfig` å­—æ®µ
- âœ… é…ç½®åˆ—è¡¨ç®¡ç†ï¼ˆæŸ¥çœ‹/ç¼–è¾‘/åˆ é™¤/å¯åœï¼‰
- âœ… è°ƒç”¨åç«¯APIï¼ˆçœŸå®æ•°æ®ï¼Œå·²ç§»é™¤Mockï¼‰

**TaskCardï¼ˆä»»åŠ¡å¡ç‰‡ï¼‰ï¼š**
- âœ… ä¸‰ç§ä»»åŠ¡ç±»å‹ï¼šæ™ºèƒ½ç›‘æ§/æ‰¹é‡ç›‘æ§/åŒºå—ç›‘æ§
- âœ… åŒºå—ç›‘æ§å»é™¤å†—ä½™å­—æ®µï¼ˆå†…å¤–ç›˜/é‡‘é¢é˜ˆå€¼ç”±é…ç½®å†³å®šï¼‰
- âœ… å…³è”é…ç½®æ”¹ä¸º**å•é€‰**ï¼ˆæ‰€æœ‰ä»»åŠ¡ç±»å‹ç»Ÿä¸€ï¼‰
- âœ… ä»»åŠ¡åˆ—è¡¨ç®¡ç†ï¼ˆæŸ¥çœ‹è¯¦æƒ…/å¯åœ/åˆ é™¤ï¼‰
- âœ… è°ƒç”¨åç«¯APIï¼ˆçœŸå®æ•°æ®ï¼Œå·²ç§»é™¤Mockï¼‰

**é¦–é¡µç»Ÿè®¡ï¼ˆindex.vueï¼‰ï¼š**
- âœ… è°ƒç”¨ `getConfigStats()` - é…ç½®ç»Ÿè®¡
- âœ… è°ƒç”¨ `getTaskStats()` - ä»»åŠ¡ç»Ÿè®¡
- âœ… è°ƒç”¨ `getBatchStats()` - æ‰¹æ¬¡ç»Ÿè®¡
- âœ… ç§»é™¤æ‰€æœ‰Mockæ•°æ®

##### å‰ç«¯APIé›†æˆ

**æ–‡ä»¶ï¼š** `src/api/crypto/monitor-v2.js`

```javascript
// é…ç½®ç®¡ç†
export function listConfig(query)
export function addConfig(data)
export function updateConfig(data)
export function delConfig(ids)
export function changeConfigStatus(id, status)
export function getConfigStats()

// ä»»åŠ¡ç®¡ç†
export function listTask(query)
export function addSmartTask(data)
export function addBatchTask(data)
export function addBlockTask(data)
export function delTask(ids)
export function startTask(id)
export function stopTask(id)
export function getTaskStats()

// æ‰¹æ¬¡ç®¡ç†
export function getBatchStats()
```

#### 4. **é—®é¢˜ä¿®å¤è®°å½•**

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ | çŠ¶æ€ |
|------|------|----------|------|
| Spring Beanæ³¨å…¥å†²çª | `TokenMonitorConfigServiceImpl` ä¸­å˜é‡åå†²çª | é‡å‘½å `monitorConfigMapper` â†’ `tokenMonitorConfigMapper` | âœ… |
| è¡¨ä¸å­˜åœ¨é”™è¯¯ | è¡¨åæœªåŠ  `_v2` åç¼€ | æ‰€æœ‰Mapper XMLæ›´æ–°è¡¨å | âœ… |
| å­—æ®µä¸å­˜åœ¨ | å­—æ®µåä¸åŒ¹é… | `config_type` â†’ `config_category`ï¼Œç§»é™¤è™šæ‹Ÿåˆ— | âœ… |
| MyBatiså‚æ•°ç»‘å®šå¼‚å¸¸ | å¤šå‚æ•°æ–¹æ³•æœªæ ‡æ³¨ `@Param` | æ·»åŠ  `@Param` æ³¨è§£ | âœ… |
| åŒºå—ç›‘æ§å­—æ®µå†—ä½™ | ä»»åŠ¡å±‚ä¿å­˜é…ç½®å±‚å­—æ®µ | ç§»é™¤ä»»åŠ¡å±‚åŒºå—ç›‘æ§å­—æ®µï¼Œç»Ÿä¸€ç”±é…ç½®å†³å®š | âœ… |
| é…ç½®é€‰æ‹©é€»è¾‘æ··ä¹± | å•é€‰/å¤šé€‰ä¸ç»Ÿä¸€ | ç»Ÿä¸€æ”¹ä¸ºå•é€‰ `configId` | âœ… |

---

### ğŸš§ è¿›è¡Œä¸­å·¥ä½œ

#### 1. **æƒé™é…ç½®ï¼ˆå¾…å®Œæˆï¼‰**

éœ€è¦åœ¨ç³»ç»Ÿèœå•ç®¡ç†ä¸­æ·»åŠ æƒé™ï¼š

**èœå•ç»“æ„å»ºè®®ï¼š**
```
ç›‘æ§ç³»ç»Ÿ V2.0
â”œâ”€â”€ é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ æŸ¥è¯¢ï¼ˆcrypto:monitor-v2:config:listï¼‰
â”‚   â”œâ”€â”€ æ–°å¢ï¼ˆcrypto:monitor-v2:config:addï¼‰
â”‚   â”œâ”€â”€ ç¼–è¾‘ï¼ˆcrypto:monitor-v2:config:editï¼‰
â”‚   â”œâ”€â”€ åˆ é™¤ï¼ˆcrypto:monitor-v2:config:removeï¼‰
â”‚   â””â”€â”€ è¯¦æƒ…ï¼ˆcrypto:monitor-v2:config:queryï¼‰
â”œâ”€â”€ ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ æŸ¥è¯¢ï¼ˆcrypto:monitor-v2:task:listï¼‰
â”‚   â”œâ”€â”€ æ–°å¢ï¼ˆcrypto:monitor-v2:task:addï¼‰
â”‚   â”œâ”€â”€ ç¼–è¾‘ï¼ˆcrypto:monitor-v2:task:editï¼‰
â”‚   â”œâ”€â”€ åˆ é™¤ï¼ˆcrypto:monitor-v2:task:removeï¼‰
â”‚   â””â”€â”€ è¯¦æƒ…ï¼ˆcrypto:monitor-v2:task:queryï¼‰
â””â”€â”€ æ‰¹æ¬¡ç®¡ç†
    â”œâ”€â”€ æŸ¥è¯¢ï¼ˆcrypto:monitor-v2:batch:listï¼‰
    â”œâ”€â”€ è¯¦æƒ…ï¼ˆcrypto:monitor-v2:batch:queryï¼‰
    â”œâ”€â”€ é‡å¯ï¼ˆcrypto:monitor-v2:batch:restartï¼‰
    â””â”€â”€ å¯¼å‡ºï¼ˆcrypto:monitor-v2:batch:exportï¼‰
```

#### 2. **æ‰¹æ¬¡ç®¡ç†åŠŸèƒ½ï¼ˆâœ… å·²å®Œæˆ - 2025-11-10ï¼‰**

- âœ… æ‰¹æ¬¡ç»Ÿè®¡æ¥å£ï¼ˆ`/stats`ï¼‰
- âœ… æ‰¹æ¬¡åˆ—è¡¨æŸ¥è¯¢ï¼ˆ`/list`ï¼‰
- âœ… æ‰¹æ¬¡è¯¦æƒ…æŸ¥è¯¢ï¼ˆ`/{id}`ï¼‰
- âœ… æ‰¹æ¬¡é¡¹æ˜ç»†æŸ¥è¯¢ï¼ˆ`/{batchId}/items`ï¼‰
- âœ… æ‰¹æ¬¡é‡å¯åŠŸèƒ½ï¼ˆ`/{id}/restart`ï¼‰
- âœ… æ‰¹æ¬¡å¿ƒè·³ç›‘æ§ï¼ˆ`/{id}/heartbeat`ï¼‰
- âœ… æ‰¹æ¬¡å¿ƒè·³æ›´æ–°ï¼ˆ`POST /{id}/heartbeat`ï¼‰

**åˆ›å»ºçš„æ–‡ä»¶**:
- `MonitorBatchController.java` - æ§åˆ¶å™¨
- `IMonitorBatchService.java` - æœåŠ¡æ¥å£
- `MonitorBatchServiceImpl.java` - æœåŠ¡å®ç°
- `MonitorBatch.java` - æ‰¹æ¬¡å®ä½“
- `MonitorBatchItem.java` - æ‰¹æ¬¡é¡¹å®ä½“
- `MonitorBatchMapper.java` - Mapperæ¥å£
- `MonitorBatchMapper.xml` - SQLé…ç½®

#### 3. **å‘Šè­¦æ—¥å¿—åŠŸèƒ½ï¼ˆå¾…å¼€å‘ï¼‰**

- â³ å‘Šè­¦åˆ—è¡¨æŸ¥è¯¢
- â³ å‘Šè­¦è¯¦æƒ…æŸ¥çœ‹
- â³ å‘Šè­¦å¤„ç†æ ‡è®°
- â³ å‘Šè­¦ç»Ÿè®¡å›¾è¡¨

#### 4. **WebSocketå®æ—¶æ¨é€ï¼ˆå¾…å¼€å‘ï¼‰**

- â³ æ‰¹æ¬¡çŠ¶æ€å®æ—¶æ¨é€
- â³ å‘Šè­¦å®æ—¶é€šçŸ¥
- â³ ä»»åŠ¡çŠ¶æ€å˜æ›´é€šçŸ¥

---

### ğŸ§ª å¾…æµ‹è¯•é¡¹

#### åŠŸèƒ½æµ‹è¯•
- [ ] é…ç½®CRUDå®Œæ•´æµç¨‹
- [ ] ä»»åŠ¡CRUDå®Œæ•´æµç¨‹ï¼ˆ3ç§ç±»å‹ï¼‰
- [ ] é…ç½®ä¸ä»»åŠ¡å…³è”é€»è¾‘
- [ ] é…ç½®å¯åœå¯¹ä»»åŠ¡çš„å½±å“
- [ ] ä»»åŠ¡å¯åœåŠŸèƒ½

#### é›†æˆæµ‹è¯•
- [ ] å‰åç«¯è”è°ƒï¼ˆé…ç½®ç®¡ç†ï¼‰
- [ ] å‰åç«¯è”è°ƒï¼ˆä»»åŠ¡ç®¡ç†ï¼‰
- [ ] æƒé™æ§åˆ¶æµ‹è¯•
- [ ] å¹¶å‘åœºæ™¯æµ‹è¯•

#### æ€§èƒ½æµ‹è¯•
- [ ] 1000ä¸ªä»»åŠ¡åŠ è½½æ€§èƒ½
- [ ] æ‰¹æ¬¡åˆ†é…ç®—æ³•æ€§èƒ½ï¼ˆ10000ç›®æ ‡ï¼‰
- [ ] é…ç½®å˜æ›´æ„ŸçŸ¥å»¶è¿Ÿ

---

### ğŸ“¦ ä¸‹ä¸€æ­¥è®¡åˆ’

#### Phase 1: å®Œå–„åŸºç¡€åŠŸèƒ½ï¼ˆæœ¬å‘¨ï¼‰
1. âœ… ~~é…ç½®ç®¡ç†UIä¼˜åŒ–~~
2. âœ… ~~ä»»åŠ¡ç®¡ç†UIä¼˜åŒ–~~
3. â³ æ·»åŠ ç³»ç»Ÿæƒé™é…ç½®
4. â³ å‰åç«¯è”è°ƒæµ‹è¯•

#### Phase 2: æ‰¹æ¬¡ç®¡ç†ï¼ˆâœ… å·²å®Œæˆ - 2025-11-10ï¼‰
1. âœ… å®ç°æ‰¹æ¬¡åˆ—è¡¨æŸ¥è¯¢
2. âœ… å®ç°æ‰¹æ¬¡ç»Ÿè®¡æ¥å£
3. âœ… å®ç°æ‰¹æ¬¡å¿ƒè·³ç›‘æ§
4. âœ… BatchCardå¯¹æ¥çœŸå®æ•°æ®
5. â³ å®ç°æ‰¹æ¬¡åˆ†é…ç®—æ³•ï¼ˆPythonç«¯ï¼‰

#### Phase 3: å‘Šè­¦ç³»ç»Ÿï¼ˆä¸‹ä¸‹å‘¨ï¼‰
1. â³ å®ç°å‘Šè­¦æ—¥å¿—è®°å½•
2. â³ å®ç°å‘Šè­¦å»é‡é€»è¾‘
3. â³ å®ç°å‘Šè­¦ç»Ÿè®¡æŸ¥è¯¢
4. â³ å‘Šè­¦ä¸­å¿ƒé¡µé¢å¼€å‘

#### Phase 4: å®æ—¶é€šçŸ¥ï¼ˆå¾…å®šï¼‰
1. â³ WebSocketæœåŠ¡ç«¯å®ç°
2. â³ å‰ç«¯WebSocketè¿æ¥
3. â³ å®æ—¶æ¨é€åŠŸèƒ½æµ‹è¯•

#### Phase 5: é›¶åœæœºè¿ç§»ï¼ˆå¾…å®šï¼‰
1. â³ æ•°æ®è¿ç§»è„šæœ¬ç¼–å†™
2. â³ åŒå†™æ¨¡å¼å®ç°
3. â³ ç°åº¦åˆ‡æ¢é€»è¾‘
4. â³ æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ

---

## ğŸ¤” å¾…è®¨è®ºé—®é¢˜

### è®®é¢˜ï¼šä»»åŠ¡ä¸é…ç½®çš„å…³è”æ–¹å¼ï¼ˆå•é€‰ vs å¤šé€‰ï¼‰

> **æå‡ºæ—¶é—´**: 2025-11-09  
> **ç´§æ€¥ç¨‹åº¦**: â­â­â­ é«˜ï¼ˆå½±å“æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘ï¼‰  
> **éœ€è¦å†³ç­–**: æ˜¯å¦å…è®¸ä¸€ä¸ªä»»åŠ¡å…³è”å¤šä¸ªé…ç½®

---

#### ğŸ“Š å½“å‰å®ç°

**å·²é‡‡ç”¨æ–¹æ¡ˆï¼šä»»åŠ¡å…³è”å•ä¸ªé…ç½®**

```javascript
// å‰ç«¯è¡¨å•
const form = reactive({
  taskName: '',
  chainType: 'sol',
  configId: null,  // âœ… å•é€‰
  // ...
})

// åç«¯æ•°æ®ç»“æ„
class MonitorTask {
  private Long configId;  // âœ… å•ä¸ªé…ç½®ID
}
```

**è®¾è®¡ç†å¿µï¼š**
```
1ä¸ªä»»åŠ¡ = 1ä¸ªé…ç½® = å¤šä¸ªäº‹ä»¶è§„åˆ™

é…ç½®ç¤ºä¾‹ï¼š
{
  "configName": "SOLå¤–ç›˜å…¨æ–¹ä½ç›‘æ§",
  "chainType": "sol",
  "marketType": "external",
  "minTransactionUsd": 500,
  "eventsConfig": [
    {"eventType": "price", "priceRisePct": 20},      // äº‹ä»¶1ï¼šä»·æ ¼ç›‘æ§
    {"eventType": "volume", "volThresholdUsd": 10000}, // äº‹ä»¶2ï¼šäº¤æ˜“é‡ç›‘æ§
    {"eventType": "holder", "holderConcentrationPct": 60} // äº‹ä»¶3ï¼šæŒä»“ç›‘æ§
  ],
  "triggerLogic": "any"
}
```

---

#### ğŸ” æ–¹æ¡ˆå¯¹æ¯”

##### æ–¹æ¡ˆAï¼šå•é€‰é…ç½®ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰âœ…

**ä¼˜ç‚¹ï¼š**
- âœ… **ç®€å•ç›´è§‚** - 1ä¸ªä»»åŠ¡å¯¹åº”1å¥—å®Œæ•´è§„åˆ™
- âœ… **é…ç½®å³è§„åˆ™é›†** - `eventsConfig` å¯åŒ…å«å¤šä¸ªäº‹ä»¶
- âœ… **é¿å…å†²çª** - ä¸å­˜åœ¨å¤šé…ç½®è§¦å‘å»é‡é—®é¢˜
- âœ… **èŒè´£æ¸…æ™°** - ä»»åŠ¡å®šä¹‰"ç›‘æ§ä»€ä¹ˆ"ï¼Œé…ç½®å®šä¹‰"å¦‚ä½•ç›‘æ§"
- âœ… **å¤ç”¨æ€§å¥½** - å¤šä¸ªä»»åŠ¡å¯ä½¿ç”¨åŒä¸€é…ç½®

**ä½¿ç”¨åœºæ™¯ï¼š**
```
åœºæ™¯1: ä¸åŒå¸‚å€¼èŒƒå›´ï¼Œç›¸åŒç›‘æ§è§„åˆ™
ä»»åŠ¡A [å¸‚å€¼10ä¸‡-100ä¸‡]   â†’ é…ç½®1 [ä»·æ ¼+äº¤æ˜“é‡+æŒä»“ç›‘æ§]  âœ… é…ç½®å¤ç”¨
ä»»åŠ¡B [å¸‚å€¼100ä¸‡-1000ä¸‡] â†’ é…ç½®1 [ä»·æ ¼+äº¤æ˜“é‡+æŒä»“ç›‘æ§]
ä»»åŠ¡C [å¸‚å€¼>1000ä¸‡]      â†’ é…ç½®1 [ä»·æ ¼+äº¤æ˜“é‡+æŒä»“ç›‘æ§]

åœºæ™¯2: åŒºå—ç›‘æ§ï¼Œå†…å¤–ç›˜åˆ†å¼€
ä»»åŠ¡A [SOLé“¾åŒºå—ç›‘æ§]   â†’ é…ç½®1 [å¤–ç›˜ + ä»·æ ¼/äº¤æ˜“é‡äº‹ä»¶]
ä»»åŠ¡B [SOLé“¾åŒºå—ç›‘æ§]   â†’ é…ç½®2 [å†…ç›˜ + æŒä»“/æµåŠ¨æ€§äº‹ä»¶]
```

**ç¼ºç‚¹ï¼š**
- âŒ **é…ç½®å†—ä½™é£é™©** - å¦‚æœéœ€è¦ä¸åŒäº‹ä»¶ç»„åˆï¼Œéœ€åˆ›å»ºå¤šä¸ªé…ç½®
- âŒ **çµæ´»æ€§ç•¥ä½** - æ— æ³•åŠ¨æ€ç»„åˆä¸åŒé…ç½®çš„è§„åˆ™

---

##### æ–¹æ¡ˆBï¼šå¤šé€‰é…ç½®ï¼ˆåŸè®¾è®¡ï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… **çµæ´»æ€§é«˜** - å¯è‡ªç”±ç»„åˆä¸åŒé…ç½®
- âœ… **é…ç½®ç»†ç²’åº¦** - æ¯ä¸ªé…ç½®ä¸“æ³¨1ä¸ªç»´åº¦
- âœ… **åŠ¨æ€è°ƒæ•´** - å¯éšæ—¶å¢å‡é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ä»»åŠ¡

**ä½¿ç”¨åœºæ™¯ï¼š**
```
ä»»åŠ¡A [å¸‚å€¼10ä¸‡-100ä¸‡]
  â”œâ”€ é…ç½®1 [ä»·æ ¼ç›‘æ§ï¼šæ¶¨å¹…>20%]
  â”œâ”€ é…ç½®2 [äº¤æ˜“é‡ç›‘æ§ï¼š5åˆ†é’Ÿ>1ä¸‡USD]
  â””â”€ é…ç½®3 [æŒä»“ç›‘æ§ï¼šå‰10>60%]

ä»»åŠ¡B [å¸‚å€¼>1000ä¸‡]
  â”œâ”€ é…ç½®1 [ä»·æ ¼ç›‘æ§ï¼šæ¶¨å¹…>20%]  â† å¤ç”¨
  â””â”€ é…ç½®4 [æµåŠ¨æ€§ç›‘æ§ï¼šLPæ’¤å‡º>10%]
```

**ç¼ºç‚¹ï¼š**
- âŒ **å¤æ‚åº¦é«˜** - éœ€è¦å¤„ç†å¤šé…ç½®è§¦å‘é€»è¾‘
- âŒ **å»é‡å›°éš¾** - åŒä¸€Tokenè§¦å‘å¤šä¸ªé…ç½®æ—¶çš„é€šçŸ¥å»é‡
- âŒ **ç†è§£æˆæœ¬** - ç”¨æˆ·éœ€ç†è§£é…ç½®ç»„åˆçš„æ•ˆæœ
- âŒ **è°ƒè¯•å›°éš¾** - å‘Šè­¦æ¥æºä¸æ˜ç¡®

**å»é‡æŒ‘æˆ˜ï¼š**
```
ä»»åŠ¡A + é…ç½®1ï¼ˆä»·æ ¼ç›‘æ§ï¼‰ â†’ Token Xæ¶¨25% â†’ è§¦å‘å‘Šè­¦
ä»»åŠ¡A + é…ç½®2ï¼ˆäº¤æ˜“é‡ç›‘æ§ï¼‰ â†’ Token Xäº¤æ˜“é‡æ¿€å¢ â†’ è§¦å‘å‘Šè­¦

é—®é¢˜ï¼šæ˜¯å‘é€1æ¡è¿˜æ˜¯2æ¡é€šçŸ¥ï¼Ÿ
- å‘é€2æ¡ â†’ ç”¨æˆ·è¢«æ‰“æ‰°
- å‘é€1æ¡ â†’ å¦‚ä½•åˆå¹¶å‘Šè­¦å†…å®¹ï¼Ÿ
```

---

#### ğŸ“ èŒè´£åˆ†ç¦»åˆ†æ

**å½“å‰æ¶æ„çš„èŒè´£åˆ’åˆ†ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä»»åŠ¡å±‚ (Task)                       â”‚
â”‚  è´Ÿè´£ï¼šç›‘æ§"ä»€ä¹ˆ" (What to Monitor)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ™ºèƒ½ç›‘æ§ï¼šå¸‚å€¼èŒƒå›´ã€Twitterè¦æ±‚ã€è‡ªåŠ¨åŒæ­¥é€»è¾‘          â”‚
â”‚ æ‰¹é‡ç›‘æ§ï¼šæŒ‡å®šçš„ç›®æ ‡åˆ—è¡¨ï¼ˆæ‰‹åŠ¨è¾“å…¥CAï¼‰                 â”‚
â”‚ åŒºå—ç›‘æ§ï¼šå…¨é“¾ç›‘å¬ï¼ˆæ— ç›®æ ‡ç­›é€‰ï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ M:1 å…³è”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é…ç½®å±‚ (Config)                      â”‚
â”‚  è´Ÿè´£ï¼šç›‘æ§"å¦‚ä½•" (How to Monitor)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç›‘æ§è§„åˆ™ï¼šä»·æ ¼å˜åŒ–ã€äº¤æ˜“é‡ã€æŒä»“é›†ä¸­åº¦                â”‚
â”‚ â€¢ åŸºç¡€å‚æ•°ï¼šmarket_typeã€é‡‘é¢é˜ˆå€¼ã€æ—¶é—´é—´éš”            â”‚
â”‚ â€¢ è§¦å‘é€»è¾‘ï¼šany/all                                   â”‚
â”‚ â€¢ é€šçŸ¥æ–¹å¼ï¼štelegram/email/webhook                    â”‚
â”‚ â€¢ äº‹ä»¶é›†åˆï¼ševentsConfig JSONæ•°ç»„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ··åˆæ¨¡å¼ï¼ˆå½“å‰å®é™…ï¼‰ï¼š**
```
ä»»åŠ¡å±‚ä¿å­˜çš„å­—æ®µï¼š
  âœ… minMarketCap / maxMarketCap (æ™ºèƒ½ç›‘æ§)
  âœ… hasTwitter (æ™ºèƒ½ç›‘æ§)
  âœ… autoSyncTargets / syncIntervalMinutes (æ™ºèƒ½ç›‘æ§è¡Œä¸º)
  âŒ marketType / minTransactionUsd (å·²åˆ é™¤ï¼Œç§»è‡³é…ç½®å±‚)

é…ç½®å±‚ä¿å­˜çš„å­—æ®µï¼š
  âœ… market_type (å†…å¤–ç›˜)
  âœ… minTransactionUsd / cumulativeMinAmountUsd (åŒºå—ç›‘æ§é˜ˆå€¼)
  âœ… eventsConfig (äº‹ä»¶è§„åˆ™ï¼šä»·æ ¼ã€äº¤æ˜“é‡ã€æŒä»“)
  âœ… triggerLogic / notifyMethods
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡åˆç†ï¼Ÿ**
1. **æ™ºèƒ½ç›‘æ§çš„å¸‚å€¼ç­›é€‰** â†’ ä»»åŠ¡å±‚
   - åŸå› ï¼šå¸‚å€¼æ˜¯**ç›®æ ‡ç­›é€‰æ¡ä»¶**ï¼Œå†³å®š"ç›‘æ§å“ªäº›Token"
   - ä¸åŒä»»åŠ¡çš„å¸‚å€¼èŒƒå›´ä¸åŒï¼Œä½†å¯ä½¿ç”¨ç›¸åŒç›‘æ§è§„åˆ™

2. **åŒºå—ç›‘æ§çš„å†…å¤–ç›˜/é‡‘é¢é˜ˆå€¼** â†’ é…ç½®å±‚
   - åŸå› ï¼šè¿™æ˜¯**ç›‘æ§è§„åˆ™çš„ä¸€éƒ¨åˆ†**ï¼Œå†³å®š"å¦‚ä½•è¿‡æ»¤äº¤æ˜“"
   - åŒºå—ç›‘æ§æ²¡æœ‰ç›®æ ‡åˆ—è¡¨ï¼Œæ‰€æœ‰ç­›é€‰éƒ½æ˜¯è§„åˆ™

---

#### ğŸ’¡ æ¨èæ–¹æ¡ˆ

**å»ºè®®ï¼šä¿æŒå•é€‰é…ç½® âœ…**

**ç†ç”±ï¼š**
1. âœ… **é…ç½®åŠŸèƒ½å·²è¶³å¤Ÿå¼ºå¤§** - `eventsConfig` å¯åŒ…å«å¤šä¸ªäº‹ä»¶è§„åˆ™
2. âœ… **é¿å…å»é‡å¤æ‚åº¦** - å•é…ç½®ä¸å­˜åœ¨å¤šè§¦å‘æºé—®é¢˜
3. âœ… **ç¬¦åˆå½“å‰æ¶æ„** - èŒè´£åˆ†ç¦»æ¸…æ™°ï¼ˆä»»åŠ¡å®šä¹‰ç›®æ ‡ï¼Œé…ç½®å®šä¹‰è§„åˆ™ï¼‰
4. âœ… **ç”¨æˆ·ä½“éªŒå¥½** - ç®€å•ç›´è§‚ï¼Œé…ç½®å³å®Œæ•´è§„åˆ™é›†
5. âœ… **å¯æ‰©å±•æ€§å¥½** - æœªæ¥å¯åœ¨é…ç½®å†…å¢åŠ æ›´å¤šäº‹ä»¶ç±»å‹

**å¦‚æœæœªæ¥éœ€è¦æ›´å¤æ‚åœºæ™¯ï¼Œå¯ä»¥ï¼š**
- **æ–¹æ¡ˆ1**: åœ¨é…ç½®å±‚å¢åŠ æ›´å¤šäº‹ä»¶ç±»å‹ï¼ˆæ¨èï¼‰
  ```json
  {
    "eventsConfig": [
      {"eventType": "price", ...},
      {"eventType": "volume", ...},
      {"eventType": "holder", ...},
      {"eventType": "liquidity", ...},  // æ–°å¢
      {"eventType": "whale_tracking", ...}  // æ–°å¢
    ]
  }
  ```

- **æ–¹æ¡ˆ2**: æ”¯æŒé…ç½®ç»§æ‰¿/æ¨¡æ¿ï¼ˆä¸­æœŸï¼‰
  ```json
  {
    "configName": "é«˜çº§ç›‘æ§",
    "baseConfig": "åŸºç¡€ä»·æ ¼ç›‘æ§",  // ç»§æ‰¿
    "eventsConfig": [...]  // é¢å¤–è§„åˆ™
  }
  ```

- **æ–¹æ¡ˆ3**: æ”¹ä¸ºå¤šé€‰é…ç½®ï¼ˆéœ€é‡æ„ï¼Œå¤„ç†å»é‡ï¼‰

---

#### ğŸ“ å†³ç­–è®°å½•

**å†³ç­–æ—¶é—´**: å¾…å®š  
**å‚ä¼šäººå‘˜**: å¾…å®š  
**æœ€ç»ˆå†³ç­–**: [ ] ä¿æŒå•é€‰ / [ ] æ”¹ä¸ºå¤šé€‰ / [ ] å…¶ä»–æ–¹æ¡ˆ

**å†³ç­–ä¾æ®ï¼š**
1. ä¸šåŠ¡åœºæ™¯ï¼šâ–¡ å•é…ç½®å¤Ÿç”¨ / â–¡ éœ€è¦å¤šé…ç½®ç»„åˆ
2. æŠ€æœ¯å¤æ‚åº¦ï¼šâ–¡ å¯æ¥å— / â–¡ è¿‡äºå¤æ‚
3. ç”¨æˆ·ä½“éªŒï¼šâ–¡ ç®€å•æ˜“ç”¨ / â–¡ çµæ´»ä¸ºå…ˆ
4. æ‰©å±•æ€§ï¼šâ–¡ æ»¡è¶³éœ€æ±‚ / â–¡ éœ€è¦å¢å¼º

**Action Itemsï¼š**
- [ ] ç¡®è®¤ä¸šåŠ¡åœºæ™¯çš„é…ç½®éœ€æ±‚
- [ ] è¯„ä¼°å¤šé…ç½®çš„å»é‡å®ç°éš¾åº¦
- [ ] å†³å®šæ˜¯å¦éœ€è¦è°ƒæ•´æ•°æ®åº“è®¾è®¡
- [ ] æ›´æ–°å‰ç«¯ç»„ä»¶ï¼ˆå¦‚éœ€è°ƒæ•´ï¼‰
- [ ] æ›´æ–°åç«¯APIï¼ˆå¦‚éœ€è°ƒæ•´ï¼‰

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®°å½•

### ç›‘æ§æ€»è§ˆé¡µé¢æ€§èƒ½ä¼˜åŒ– (2025-11-10)

#### é—®é¢˜æè¿°
ç›‘æ§æ€»è§ˆé¡µé¢ï¼ˆ`/monitor-v2/dashboard`ï¼‰å­˜åœ¨ä¸¥é‡çš„å¡é¡¿é—®é¢˜ï¼š
- **ç°è±¡**: é¡µé¢åŠ è½½æ—¶å¡é¡¿5-10ç§’ï¼Œç”¨æˆ·ä½“éªŒæå·®
- **å½±å“èŒƒå›´**: ä»…ç›‘æ§æ€»è§ˆé¡µé¢ï¼Œå…¶ä»–é¡µé¢æ­£å¸¸
- **ç”¨æˆ·åé¦ˆ**: "æ•´ä¸ªé¡µé¢ä¼šå¡5ç§’é’Ÿï¼Œæˆ‘32Gè¿å­˜ + I5 11500éƒ½è¿™æ ·ï¼"

#### æ€§èƒ½è¯Šæ–­è¿‡ç¨‹

##### 1. åˆæ­¥è¯Šæ–­
æ·»åŠ æ€§èƒ½ç›‘æ§ä»£ç ï¼Œå‘ç°ï¼š
- âœ… **APIå“åº”æ—¶é—´**: 200-300msï¼ˆæ­£å¸¸ï¼‰
- âœ… **JavaScriptæ‰§è¡Œ**: 300-400msï¼ˆæ­£å¸¸ï¼‰
- âŒ **ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿ**: 5-10ç§’ï¼ˆå¼‚å¸¸ï¼‰

```javascript
// ç›‘æ§ä»£ç è¾“å‡º
âœ… Dashboard APIåŠ è½½å®Œæˆ: 287ms
âœ… Dashboard æµè§ˆå™¨æ¸²æŸ“å®Œæˆ: 339ms
âš ï¸ é•¿ä»»åŠ¡é˜»å¡: 248ms - self
âš ï¸ é•¿ä»»åŠ¡é˜»å¡: 92ms - self
```

##### 2. æ’æŸ¥æ–¹å‘
å¯¹æ¯”å‘ç°ï¼š
- APIå’ŒJSæ‰§è¡Œéƒ½å¾ˆå¿«ï¼ˆ<400msï¼‰
- ä½†ç”¨æˆ·æ„Ÿè§‰å¡äº†5-10ç§’
- **ç»“è®º**: é—®é¢˜ä¸åœ¨ç½‘ç»œå’ŒJSè®¡ç®—ï¼Œè€Œåœ¨**ç»„ä»¶æ¸²æŸ“**

##### 3. é€ä¸ªæ’é™¤ç»„ä»¶
ä½¿ç”¨**æ§åˆ¶å˜é‡æ³•**ï¼Œé€ä¸ªæ³¨é‡Šç»„ä»¶æµ‹è¯•ï¼š

| ç»„ä»¶ | ç§»é™¤åæ•ˆæœ | ç»“è®º |
|------|-----------|------|
| BatchStatusChartï¼ˆé¥¼å›¾ï¼‰ | è¿˜æ˜¯å¡ | âœ… ä¸æ˜¯é—®é¢˜ç»„ä»¶ |
| TaskTypeChartï¼ˆæŸ±çŠ¶å›¾ï¼‰ | è¿˜æ˜¯å¡ | âœ… ä¸æ˜¯é—®é¢˜ç»„ä»¶ |
| RelationChartï¼ˆé“¾è·¯å›¾ï¼‰ | **å®Œå…¨ä¸å¡äº†ï¼** | âŒ **é—®é¢˜ç»„ä»¶** |

**å…³é”®æµ‹è¯•æ•°æ®å¯¹æ¯”**ï¼š
```
æœ‰RelationChart:  å¡5-10ç§’ï¼ˆç”¨æˆ·æ„ŸçŸ¥ï¼‰
æ— RelationChart:  âœ… è·¯ç”±åˆ‡æ¢å®Œæˆ: 384ms
                 âœ… Dashboard æµè§ˆå™¨æ¸²æŸ“å®Œæˆ: 327ms
                 âœ… ä¸€ç‚¹éƒ½ä¸å¡äº†ï¼
```

#### æ ¹å› åˆ†æ

`RelationChart.vue` ç»„ä»¶çš„æ€§èƒ½é—®é¢˜ï¼š

##### 1. **ç®—æ³•å¤æ‚åº¦é«˜**
```javascript
// é—®é¢˜ä»£ç ï¼šåµŒå¥—å¾ªç¯è¿‡å¤š
const relationChains = computed(() => {
  configs.value.forEach(config => {
    // O(N)
    const configTaskLinks = links.filter(link => 
      link.source === config.name && 
      tasks.value.find(t => t.name === link.target)  // O(M) åµŒå¥—
    )
    
    configTaskLinks.forEach(link => {
      // O(K)
      const taskBatchLinks = links.filter(l =>  // O(L) å†æ¬¡åµŒå¥—
        l.source === task.name && 
        batches.value.find(b => b.name === l.target)  // O(P) å››å±‚åµŒå¥—ï¼
      )
    })
  })
})

// æ—¶é—´å¤æ‚åº¦: O(N * M * K * L * P) â‰ˆ O(n^5) çº§åˆ«ï¼
```

##### 2. **DOMæ¸²æŸ“é‡å·¨å¤§**
åŸè®¾è®¡ä½¿ç”¨ `el-collapse` åµŒå¥—ç»“æ„ï¼š
```vue
<el-collapse>  <!-- é…ç½®å±‚ -->
  <el-collapse-item v-for="config">  <!-- 5ä¸ªé…ç½® -->
    <el-collapse>  <!-- ä»»åŠ¡å±‚ -->
      <el-collapse-item v-for="task">  <!-- æ¯ä¸ªé…ç½®3-5ä¸ªä»»åŠ¡ -->
        <div v-for="batch">  <!-- æ¯ä¸ªä»»åŠ¡2-5ä¸ªæ‰¹æ¬¡ -->
          <!-- æ€»è®¡å¯èƒ½æ¸²æŸ“: 5 * 5 * 5 = 125+ ä¸ªcollapseç»„ä»¶ -->
```

**é—®é¢˜**ï¼š
- æ¯ä¸ª `el-collapse` éƒ½æœ‰åŠ¨ç”»å’Œäº¤äº’é€»è¾‘
- å¤§é‡åµŒå¥—çš„ collapse å¯¼è‡´ Layout/Paint å¼€é”€æå¤§
- å³ä½¿æ•°æ®é‡ä¸å¤§ï¼ˆ5ä¸ªé…ç½®ï¼‰ï¼Œä¹Ÿä¼šå¡æ­»

##### 3. **Computedé‡å¤è®¡ç®—**
æ¯æ¬¡æ•°æ®å˜åŒ–éƒ½è§¦å‘å®Œæ•´çš„é“¾è·¯å…³ç³»é‡æ–°è®¡ç®—ï¼š
- `configs` computed
- `tasks` computed  
- `batches` computed
- `relationChains` computedï¼ˆæœ€å¤æ‚ï¼‰
- `orphanTasks` computed

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆé€‰æ‹©**: æç®€è¡¨æ ¼ï¼ˆæ¨èï¼‰

**è®¾è®¡æ€è·¯**ï¼š
- âŒ æ”¾å¼ƒå¤æ‚çš„æ ‘å½¢/æŠ˜å ç»“æ„
- âœ… ä½¿ç”¨ç®€å•çš„ `el-table` å±•ç¤º
- âœ… ä¼˜åŒ–ç®—æ³•ï¼šå°† O(n^5) é™ä½åˆ° O(n^2)
- âœ… å‡å°‘DOMæ¸²æŸ“ï¼šä»125+ä¸ªç»„ä»¶é™åˆ°10+ä¸ª

**æ–°ç»„ä»¶ä»£ç **ï¼š`RelationTable.vue`

```vue
<el-table :data="tableData">
  <el-table-column prop="configName" label="é…ç½®åç§°" />
  <el-table-column prop="chainType" label="é“¾ç±»å‹" />
  <el-table-column prop="taskCount" label="å…³è”ä»»åŠ¡" />
  <el-table-column prop="batchCount" label="äº§ç”Ÿæ‰¹æ¬¡" />
  <el-table-column label="ä»»åŠ¡è¯¦æƒ…">
    <template #default="{ row }">
      <el-tag v-for="task in row.tasks">
        {{ task.name }} ({{ task.batchCount }}æ‰¹æ¬¡)
      </el-tag>
    </template>
  </el-table-column>
</el-table>
```

**ä¼˜åŒ–åçš„ç®—æ³•**ï¼š
```javascript
const tableData = computed(() => {
  const result = []
  
  // O(N) - éå†é…ç½®
  configs.value.forEach(config => {
    const row = { taskCount: 0, batchCount: 0, tasks: [] }
    
    // O(M) - éå†linksï¼ˆä¸€æ¬¡ï¼‰
    links.forEach(link => {
      if (link.source === config.name) {
        const task = tasksMap.get(link.target)  // O(1) ä½¿ç”¨Map
        if (task) {
          row.taskCount++
          row.tasks.push(...)
        }
      }
    })
    
    result.push(row)
  })
  
  return result
})

// æ–°çš„æ—¶é—´å¤æ‚åº¦: O(N * M) â‰ˆ O(n^2) - é™ä½äº†3ä¸ªæ•°é‡çº§ï¼
```

#### æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ï¼ˆRelationChartï¼‰ | ä¼˜åŒ–åï¼ˆRelationTableï¼‰ | æå‡ |
|------|------------------------|------------------------|------|
| **ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿ** | 5-10ç§’ | 0.3ç§’ | **30å€** |
| **é¡µé¢æ¸²æŸ“æ—¶é—´** | æœªæµ‹é‡ï¼ˆå¤ªæ…¢ï¼‰ | 327ms | - |
| **DOMèŠ‚ç‚¹æ•°é‡** | ~125+ collapse | ~10 table rows | **12å€å‡å°‘** |
| **ç®—æ³•å¤æ‚åº¦** | O(n^5) | O(n^2) | **1000å€** |
| **Computedè§¦å‘** | 5ä¸ªå¤æ‚è®¡ç®— | 2ä¸ªç®€å•è®¡ç®— | **2.5å€å‡å°‘** |

#### å®æ–½ç»“æœ

âœ… **é—®é¢˜å®Œå…¨è§£å†³**ï¼š
- ä»é¦–é¡µåˆ‡æ¢åˆ°ç›‘æ§æ€»è§ˆï¼š**384ms**ï¼ˆ< 0.5ç§’ï¼‰
- é¡µé¢å®Œå…¨æ¸²æŸ“å®Œæˆï¼š**327ms**
- ç”¨æˆ·åé¦ˆï¼š"ä¸€ç‚¹éƒ½ä¸å¡äº†ï¼"

âœ… **åŠŸèƒ½å®Œæ•´æ€§**ï¼š
- ä¿ç•™äº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½
- æ•°æ®å±•ç¤ºæ›´æ¸…æ™°ç›´è§‚
- æ”¯æŒå­¤ç«‹ä»»åŠ¡æç¤º

âœ… **å¯ç»´æŠ¤æ€§æå‡**ï¼š
- ä»£ç ä»343è¡Œé™åˆ°140è¡Œ
- ç®—æ³•é€»è¾‘ç®€å•æ˜“æ‡‚
- æ— å¤æ‚åµŒå¥—ç»“æ„

#### ç»éªŒæ€»ç»“

##### 1. **æ€§èƒ½ä¼˜åŒ–çš„é»„é‡‘æ³•åˆ™**
- ğŸ¯ **å…ˆå®šä½å†ä¼˜åŒ–**ï¼šä¸è¦ç›²ç›®ä¼˜åŒ–ï¼Œç”¨æ•°æ®è¯´è¯
- ğŸ“Š **æ§åˆ¶å˜é‡æ³•**ï¼šé€ä¸ªæ’é™¤ç»„ä»¶ï¼Œç²¾ç¡®å®šä½é—®é¢˜
- ğŸš€ **ç®€å•å°±æ˜¯ç¾**ï¼šå¤æ‚çš„UIå¾€å¾€æ˜¯æ€§èƒ½æ€æ‰‹

##### 2. **å¸¸è§æ€§èƒ½é™·é˜±**
- âŒ **åµŒå¥—å¾ªç¯åœ°ç‹±**ï¼šcomputedé‡Œå¤šå±‚filter/findåµŒå¥—
- âŒ **è¿‡åº¦è®¾è®¡UI**ï¼šä¸å¿…è¦çš„æŠ˜å ã€åŠ¨ç”»ã€åµŒå¥—ç»„ä»¶
- âŒ **å¿½è§†DOMæ•°é‡**ï¼š100+ä¸ªç»„ä»¶vs 10ä¸ªç»„ä»¶å·®è·å·¨å¤§

##### 3. **Vueæ€§èƒ½ç›‘æ§æŠ€å·§**
```javascript
// 1. ä½¿ç”¨requestAnimationFrameç›‘æ§çœŸå®æ¸²æŸ“
requestAnimationFrame(() => {
  console.log('çœŸå®æ¸²æŸ“å®Œæˆ')
})

// 2. ä½¿ç”¨PerformanceObserverç›‘æ§é•¿ä»»åŠ¡
new PerformanceObserver(list => {
  if (entry.duration > 50) {
    console.warn('é•¿ä»»åŠ¡é˜»å¡:', entry.duration)
  }
})

// 3. åœ¨computedä¸­æ·»åŠ æ€§èƒ½ç›‘æ§
const data = computed(() => {
  const start = performance.now()
  // ... è®¡ç®—é€»è¾‘
  console.log('è®¡ç®—è€—æ—¶:', performance.now() - start)
})
```

##### 4. **è®¾è®¡å»ºè®®**
å¯¹äºç›‘æ§æ€»è§ˆ/Dashboardç±»é¡µé¢ï¼š
- âœ… **ä¼˜å…ˆè€ƒè™‘è¡¨æ ¼**ï¼šel-table æ€§èƒ½è¿œè¶…åµŒå¥—ç»„ä»¶
- âœ… **å‡å°‘åµŒå¥—å±‚çº§**ï¼šæœ€å¤š2-3å±‚
- âœ… **é¿å…è¿‡åº¦åŠ¨ç”»**ï¼šæŠ˜å /è¿‡æ¸¡åŠ¨ç”»ä¼šæ‹–æ…¢æ¸²æŸ“
- âœ… **æ•°æ®é‡å¤§æ—¶åˆ†é¡µ**ï¼šå•é¡µä¸è¶…è¿‡50æ¡è®°å½•

#### åç»­è®¡åˆ’

- [ ] å¦‚æœæ•°æ®é‡å¢é•¿åˆ°100+é…ç½®ï¼Œè€ƒè™‘æ·»åŠ åˆ†é¡µ
- [ ] è€ƒè™‘æ·»åŠ "å±•å¼€è¯¦æƒ…"åŠŸèƒ½ï¼ŒæŒ‰éœ€åŠ è½½æ‰¹æ¬¡ä¿¡æ¯
- [ ] è¯„ä¼°æ˜¯å¦éœ€è¦è™šæ‹Ÿæ»šåŠ¨ï¼ˆå½“å‰æ•°æ®é‡ä¸éœ€è¦ï¼‰

---

*æœ€åæ›´æ–°: 2025-11-10*

